var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,f){a!=Array.prototype&&a!=Object.prototype&&(a[b]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill=function(a,b,f,g){if(b){f=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var d=a[g];d in f||(f[d]={});f=f[d]}a=a[a.length-1];g=f[a];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,g)||$jscomp.defineProperty(a,g,{value:{}})}function f(a){var c=Object[a];c&&(Object[a]=function(h){b(h);return c(h)})}if(function(){if(!a||!Object.seal)return!1;try{var d=Object.seal({}),c=Object.seal({}),h=new a([[d,2],[c,3]]);if(2!=h.get(d)||3!=h.get(c))return!1;h.delete(d);h.set(c,4);return!h.has(d)&&4==h.get(c)}catch(l){return!1}}())return a;var g="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var d=0,k=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};k.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+a);a[g][this.id_]=c;return this};k.prototype.get=function(a){return $jscomp.owns(a,g)?a[g][this.id_]:void 0};k.prototype.has=function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)};k.prototype.delete=
function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)?delete a[g][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),h=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=h.get(c)||1!=h.size||h.get({x:4})||h.set({x:4},"t")!=h||2!=h.size)return!1;var l=h.entries(),d=l.next();if(d.done||d.value[0]!=c||"s"!=d.value[1])return!1;d=l.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!l.next().done?!1:!0}catch(u){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,f=function(c){this.data_={};this.head_=k();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var h;!(h=c.next()).done;)h=h.value,this.set(h[0],h[1])}};f.prototype.set=function(c,h){var a=g(this,c);a.list||(a.list=this.data_[a.id]=[]);a.entry?a.entry.value=h:(a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:h},a.list.push(a.entry),this.head_.previous.next=a.entry,this.head_.previous=a.entry,this.size++);return this};f.prototype.delete=
function(c){c=g(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=k();this.size=0};f.prototype.has=function(c){return!!g(this,c).entry};f.prototype.get=function(c){return(c=g(this,c).entry)&&c.value};f.prototype.entries=function(){return d(this,function(c){return[c.key,
c.value]})};f.prototype.keys=function(){return d(this,function(c){return c.key})};f.prototype.values=function(){return d(this,function(c){return c.value})};f.prototype.forEach=function(c,h){for(var a=this.entries(),d;!(d=a.next()).done;)d=d.value,c.call(h,d[1],d[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var g=function(c,h){var a=h&&typeof h;"object"==a||"function"==a?b.has(h)?a=b.get(h):(a=""+ ++p,b.set(h,a)):a="p_"+h;var d=c.data_[a];if(d&&$jscomp.owns(c.data_,a))for(c=0;c<d.length;c++){var f=
d[c];if(h!==h&&f.key!==f.key||h===f.key)return{id:a,list:d,index:c,entry:f}}return{id:a,list:d,index:-1,entry:void 0}},d=function(c,a){var h=c.head_;return $jscomp.iteratorPrototype(function(){if(h){for(;h.head!=c.head_;)h=h.previous;for(;h.next!=h.head;)return h=h.next,{done:!1,value:a(h)};h=null}return{done:!0,value:void 0}})},k=function(){var c={};return c.previous=c.next=c.head=c},p=0;return f},"es6","es3");
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),g=new a($jscomp.makeIterator([b]));if(!g.has(b)||1!=g.size||g.add(b)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var d=g.entries(),k=d.next();if(k.done||k.value[0]!=b||k.value[1]!=b)return!1;k=d.next();return k.done||k.value[0]==b||4!=k.value[0].x||k.value[1]!=k.value[0]?!1:d.next().done}catch(p){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var d=this;this.map_.forEach(function(k){return a.call(b,k,k,d)})};return b},"es6","es3");$jscomp.findInternal=function(a,b,f){a instanceof String&&(a=String(a));for(var g=a.length,d=0;d<g;d++){var k=a[d];if(b.call(f,k,d,a))return{i:d,v:k}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).v}},"es6","es3");var vga=vga||{};vga.irc=vga.irc||{};vga.irc.roles={owner:32,admin:16,mod:8,guest:4,turbo:2,shadow:1,none:0};vga.irc.status={muted:4,timed:2,banned:1,nominal:0};vga.irc.roleModeAction={remove:0,add:1};vga.irc.channelmodes={turbo:1,none:0};vga.irc.smoothScrollState={stopped:0,started:1,paused:2};vga.irc.messageType={message:0,action:1,whisper:2};
vga.irc.bitArray=vga.irc.bitArray||{};vga.irc.bitArray.getMostSignificantValue=function(a,b,f){for(b=vga.util.propertyCount(b)-1;0<=b;b--){var g=1<<b;if((a&g)===g)return g}return f};vga.irc.bitArray.add=function(a,b){return a|b};vga.irc.bitArray.remove=function(a,b){return a^a&b};vga.irc.bitArray.contains=function(a,b){return a&b===b};
vga.irc.bitArray.compileBitArray=function(a,b,f){a=a||[];if(!b)throw new "The transformFunction is undefined.";f=void 0!==f?f:0;return 0===a.length?f:1===a.length?f|(b(a[0])||0):a.reduce(function(a,d){return a|(b[d]||0)},f)};vga.irc.getMostSignificantRole=function(a){return vga.irc.bitArray.getMostSignificantValue(a,vga.irc.roles,vga.irc.roles.shadow)};vga.irc.getMostSignificantStatus=function(a){return vga.irc.bitArray.getMostSignificantValue(a,vga.irc.status,vga.irc.status.nominal)};vga=vga||{};vga.irc=vga.irc||{};vga.irc.userEntity=function(a,b,f){this.roles=void 0!==f?f:vga.irc.roles.shadow;this.status=vga.irc.status.nominal;this.identity=a;this.nicknames=void 0!==b?Array.isArray(b)?b:[b]:[]};vga.irc.userEntity.prototype.applyRoles=function(a,b){this.roles=a===vga.irc.roleModeAction.add?vga.irc.bitArray.add(this.roles,b):vga.irc.bitArray.remove(this.roles,b);return this};
vga.irc.userEntity.prototype.applyStatus=function(a,b){this.status=a===vga.irc.roleModeAction.add?vga.irc.bitArray.add(this.status,b):vga.irc.bitArray.remove(this.status,b);return this};vga.irc.userEntity.prototype.addNickname=function(a){-1===this.nicknames.indexOf(a)&&this.nicknames.push(a);return this};vga.irc.userEntity.prototype.removeNickname=function(a){a=this.nicknames.indexOf(a);if(-1<a){var b=this.nicknames.pop();b&&a<this.nicknames.length&&(this.nicknames[a]=b)}return this};vga=vga||{};vga.irc=vga.irc||{};vga.irc.connector=vga.irc.connector||{};vga.irc.connector.kiwi=vga.irc.connector.kiwi||{};
(function(){function a(a){a=a||{};return{nick:a.nick,hostname:a.hostname,port:a.port,ssl:a.ssl,password:a.password}}function b(a,b){return{method:a,params:b}}function f(a,k){return b(vga.irc.connector.kiwi.PROXY_PREFIX+"."+a,k||[])}vga.irc.connector.kiwi.PACKET_STATUS={OPEN:0,CLOSE:1,PING:2,PONG:3,MESSAGE:4,UPGRADE:5,NOOP:6};vga.irc.connector.kiwi.STATES={CLOSED:0,CLOSING:1,OPENING:2,SOCKET_OPENED:3,PROXY_OPENED:4,PROXY_CONNECTED:5,OPENED:6};var g={connect:"onConnect",channel:"onChannel",options:"onOptions",
irc_error:"onError",disconnect:"onDisconnect",message:"onMessage",userlist:"onUserlist",userlist_end:"onUserlistEnd",channel_info:"onChannelInfo",nick:"onNick",mode:"onMode",topic:"onTopic",quit:"onQuit"};vga.irc.connector.kiwi.DEFAULT_PING_INTERVAL=15E3;vga.irc.connector.kiwi.DEFAULT_HEARTBEAT_INTERVAL=6E4;vga.irc.connector.kiwi.PROXY_PREFIX="kiwi";vga.irc.connector.kiwi.IRC_PREFIX="irc";vga.irc.connector.kiwi.protocolwrapper=function(a,b){b=b||{};this._url=a||"";this._state=vga.irc.connector.kiwi.STATES.CLOSED;
this._connectionInfo={};this._pingId=this._heartbeatId=null;this._listener=new vga.util.listener(g,b.listeners);this._socket=new vga.util.websocket(this._url,{listeners:[this]})};vga.irc.connector.kiwi.protocolwrapper.prototype.getState=function(){return this._state};vga.irc.connector.kiwi.protocolwrapper.prototype.sendRawData=function(a,b,f){b=void 0!==b?b:vga.irc.connector.kiwi.PACKET_STATUS.MESSAGE;this._socket&&(a=a?b+("object"===typeof a?JSON.stringify(a):a):b,this._socket.send(a,f));return this};
vga.irc.connector.kiwi.protocolwrapper.prototype.sendIRCData=function(a,f){return this.sendRawData(b(vga.irc.connector.kiwi.IRC_PREFIX+"."+a,[(this._connectionInfo||{connectionId:0}).connectionId,f,null]))};vga.irc.connector.kiwi.protocolwrapper.prototype.open=function(a){a=a||{};this._state=vga.irc.connector.kiwi.STATES.OPENING;this._socket&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.open]: Attempting to open."),this._socket.open(a));return this};vga.irc.connector.kiwi.protocolwrapper.prototype.cleanUp=
function(){clearTimeout(this._heartbeatId);clearTimeout(this._pingId);this._pingId=this._heartbeatId=null;return this};vga.irc.connector.kiwi.protocolwrapper.prototype.close=function(a){this.cleanUp();this._state!==vga.irc.connector.kiwi.STATES.CLOSED&&this._state!==vga.irc.connector.kiwi.STATES.CLOSING&&(this._state=vga.irc.connector.kiwi.STATES.CLOSING,this._socket&&this._socket.close());return this};vga.irc.connector.kiwi.protocolwrapper.prototype.dispose=function(){this.close();this._socket=null;
return this};vga.irc.connector.kiwi.protocolwrapper.prototype.onProxyOpened=function(a){a=a||{};vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onProxyOpened]: Proxy Connection Opened (Sid: "+a.sid+", PingInterval: "+a.pingInterval+", PingTimeout: "+a.pingTimeout+").");this._state=vga.irc.connector.kiwi.STATES.PROXY_OPENED;this._connectionInfo={sid:a.sid,pingInterval:a.pingInterval,pingTimeout:a.pingTimeout,connectionId:0}};vga.irc.connector.kiwi.protocolwrapper.prototype.onProxyConnected=
function(a){var b=this;this._state=vga.irc.connector.kiwi.STATES.PROXY_CONNECTED;vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onProxyConnected]: Proxy Connected.");if(!this._heartbeatId){var d=this._connectionInfo.pingTimeout||vga.irc.connector.kiwi.DEFAULT_HEARTBEAT_INTERVAL,c=function(){b._heartbeatId=setTimeout(function(){b.sendRawData(f("heartbeat"));c()},d)};c()}if(!this._pingId){var h=this._connectionInfo.pingInterval||vga.irc.connector.kiwi.DEFAULT_PING_INTERVAL,l=function(){b._pingId=
setTimeout(function(){b.sendRawData("",vga.irc.connector.kiwi.PACKET_STATUS.PING);l()},h)};l()}};vga.irc.connector.kiwi.protocolwrapper.prototype.onConnect=function(a){this._state===vga.irc.connector.kiwi.STATES.PROXY_CONNECTED&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onConnect]: Received a PROXY_CONNECTED state, setting OPENED state."),this._state=vga.irc.connector.kiwi.STATES.OPENED,this._connectionInfo.connectionId=a.connection_id)};vga.irc.connector.kiwi.protocolwrapper.prototype.onOpen=
function(b,k){var d=this;this._state=vga.irc.connector.kiwi.STATES.SOCKET_OPENED;vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onOpen]",b);this.sendRawData("",vga.irc.connector.kiwi.PACKET_STATUS.UPGRADE);var c=function(){setTimeout(function(){d._state===vga.irc.connector.kiwi.STATES.PROXY_CONNECTED?(d.sendRawData(f("client_info",[{build_version:vga.irc.connector.kiwi.CLIENT_VERSION.toString()}])),d.sendRawData(f("connect_irc",a(k)),void 0,!1)):d._state===vga.irc.connector.kiwi.STATES.CLOSED?
vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onOpen]: Received a CLOSED state before completing the transition to the PROXY_CONNECTED state."):c()},500)};c()};vga.irc.connector.kiwi.protocolwrapper.prototype.onClose=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onClose]: (State before close: "+this._state+").");a=this._state===vga.irc.connector.kiwi.STATES.CLOSING?{reason:"User closed the connection.",closedByServer:!1,existingConnection:!0}:{reason:"Server closed the connection.",
closedByServer:!0,existingConnection:this._state===vga.irc.connector.kiwi.STATES.OPENED};this._state=vga.irc.connector.kiwi.STATES.CLOSED;this.cleanUp();this._listener.invokeListeners("disconnect",a)};vga.irc.connector.kiwi.protocolwrapper.prototype.onMessage=function(a){a=a.data;var b=parseInt(a.substring(0,1));a=JSON.parse(a.substring(1)||"{}");if(void 0===a)vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: Empty message.");else switch(b){case vga.irc.connector.kiwi.PACKET_STATUS.OPEN:this.onProxyOpened(a);
break;case vga.irc.connector.kiwi.PACKET_STATUS.MESSAGE:b=a.params[0].data||{};var d=a.params[0].command.toLowerCase()||"";vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: (EventData: "+b+", Command: "+d+").",b);if(a.method===vga.irc.connector.kiwi.PROXY_PREFIX)this.onProxyConnected(b);else if(a.method===vga.irc.connector.kiwi.IRC_PREFIX){if("connect"===d)this.onConnect(b);else if("disconnect"==d){this.onClose({reason:b.reason});break}this._listener.invokeListeners(d,b)}else vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: (Unknown method: "+
a.method+").");break;case vga.irc.connector.kiwi.PACKET_STATUS.PONG:vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: Server Pong.");break;case vga.irc.connector.kiwi.PACKET_STATUS.PING:vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: Server Ping responding with Pong.");this.sendRawData(vga.irc.connector.kiwi.PACKET_STATUS.PONG);break;default:vga.util.debuglog.info("[vga.irc.connector.kiwi.protocolwrapper.onMessage]: (Unhandled status: "+b+").")}}})();vga=vga||{};vga.irc=vga.irc||{};vga.irc.connector=vga.irc.connector||{};vga.irc.connector.kiwi=vga.irc.connector.kiwi||{};
(function(){function a(c){var a=c.lastIndexOf("_"),b=1;-1<a&&(b=(parseInt(c.substring(a+1))||0)+1,c=c.substring(0,a));return c+"_"+b}vga.irc.connector.kiwi.accessDeniedRegEx=/^Closing link: [^\r\n]*\[Access denied\]$/;vga.irc.connector.kiwi.pingTimeoutRegEx=/^Closing link: [^\r\n]*\[Ping timeout: \d+ seconds\]$/;vga.irc.connector.kiwi.registrationTimeOutRegEx=/^Closing link: [^\r\n]*\[Registration timeout\]$/;vga.irc.connector.kiwi.serverShutDownRegEx=/^Closing link: [^\r\n]*\[Server shutdown\]$/;
vga.irc.connector.kiwi.banMaskToApply="*!{identity}@*";vga.irc.connector.kiwi.banMaskRegEx=/(\w:)?([\w\-\[\]\\\`\^\{\|\}\*]+)!([\w\-\[\]\\\`\^\{\|\}\*]+)@.+/;vga.irc.connector.kiwi.supportedNicknameRegEx=/[a-zA-Z_]?[a-zA-Z0-9\-\[\]{}`\^\\_]+/;vga.irc.connector.kiwi.supportedNicknameFirstCharEx=/[a-zA-Z]/;vga.irc.connector.kiwi.wildCardMaskRegString="[\\w\\-\\[\\]\\`\\^\\{\\|\\}\\*]*";var b={"~":"q","&":"a","@":"o","%":"h","+":"v"},f={q:vga.irc.roles.owner,a:vga.irc.roles.admin,o:vga.irc.roles.mod,
h:vga.irc.roles.guest,v:vga.irc.roles.turbo},g={b:vga.irc.status.banned},d={m:vga.irc.channelmodes.turbo},k={};k[vga.irc.channelmodes.turbo]="m";var p={connect:"onConnect",disconnect:"onDisconnect",reconnect:"onReconnect",message:"onMessage",topic:"onTopic",userlist:"onUserlist",join:"onJoin",part:"onLeave",quit:"onQuit",nick:"onNick",channelmode:"onChannelMode",role:"onRole",status:"onStatus",accessdenied:"onAccessDenied",kicked:"onKicked",kick:"onKicked",banned:"onBanned",error:"onError"};vga.irc.connector.kiwi.connector=
function(c,a){vga.irc.connector.kiwi.CLIENT_VERSION=new vga.util.version(1,0,1);a=a||{};this._knownIdentities=new Set;this._userListByChannel={};this._prefixMap={};this._nickname=this._identity="";this._consolidateNicknames=void 0!==a.consolidateNicknames?a.consolidateNicknames:!1;this._autoJoinChannel=void 0!==a.autoJoinChannel?a.autoJoinChannel:!0;this._autoJoinChannelComplete=!1;this._supportConcurrentChannelJoins=void 0!==a.supportConcurrentChannelJoins?a.supportConcurrentChannelJoins:!0;this._attemptReconnect=
void 0!==a.attemptReconnect?a.attemptReconnect:!1;this._maxNumberOfReconnectAttempts=a.maxNumberOfReconnectAttempts||3;this._numberOfReconnectsAttempted=0;this._listener=new vga.util.listener(p,a.listeners);this._protocol=new vga.irc.connector.kiwi.protocolwrapper(c,{listeners:[this]});console.log("[vga.irc.connector.kiwi.connector]: Using the kiwi-connector version: "+vga.irc.connector.kiwi.CLIENT_VERSION.toString())};vga.irc.connector.kiwi.connector.prototype.getMyIdentity=function(){return this._identity};
vga.irc.connector.kiwi.connector.prototype.getMyNickname=function(){return this.normalizeNickname(this._nickname)};vga.irc.connector.kiwi.connector.prototype.getMyUserKey=function(){return this.generateUserKey(this._nickname)};vga.irc.connector.kiwi.connector.prototype.isMe=function(c){return this._nickname.toLocaleLowerCase()===c.toLocaleLowerCase()||this._identity.toLocaleLowerCase()===c.toLocaleLowerCase()};vga.irc.connector.kiwi.connector.prototype.normalizeNickname=function(c){if(this._consolidateNicknames){for(var a=
[],b=c.length-1;0<=b;b--)"_"===c[b]&&a.push(b);if(0<a.length)if(1===a.length&&0===(void 0!==a[0]?a[0]:-1))c=c.substring(1);else{b=0;for(var d="";0<a.length;){var f=a.pop();0<f&&(d+=c.substring(b,f));b=f+1}c=d||c}}return c};vga.irc.connector.kiwi.connector.prototype.generateUserKey=function(a){return this.normalizeNickname(a).toLocaleLowerCase()};vga.irc.connector.kiwi.connector.prototype.generateChannelKey=function(a){return a.toLocaleLowerCase()};vga.irc.connector.kiwi.connector.prototype.connect=
function(a){a=a||{};if(this._protocol){this._protocol.open(a);var c=this._protocol.getState();if(c===vga.irc.connector.kiwi.STATES.CLOSED||c===vga.irc.connector.kiwi.STATES.OPENING)this._autoJoinChannel=(a.channel||"").toLowerCase(),this._userListByChannel={},this._prefixMap={},this._nickname=this._identity=a.nick}return this};vga.irc.connector.kiwi.connector.prototype.send=function(a,b){a&&b&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.send]: Sending to ("+a+"): "+b+"."),this._protocol&&
this._protocol.sendIRCData("privmsg",{target:a,msg:b}));return this};vga.irc.connector.kiwi.connector.prototype.emote=function(a,b){a&&b&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.emote]: Sending to ("+a+"): "+b+"."),this._protocol&&this._protocol.sendIRCData("ctcp",{is_request:!0,type:"ACTION",target:a,params:b}));return this};vga.irc.connector.kiwi.connector.prototype.join=function(a){if(a)return vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.join]: Attempting to join channel: "+
a+"."),this._protocol&&this._protocol.sendIRCData("join",{channel:a,key:""}),this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.join]: Invalid channel.",a);return this};vga.irc.connector.kiwi.connector.prototype.leave=function(a,b){if(a)return vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.leave]: Attempting to leave channel: "+a+"."),this._protocol&&this._protocol.sendIRCData("part",{channel:a,message:b}),this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.leave]: Invalid channel.",
a);return this};vga.irc.connector.kiwi.connector.prototype.setMode=function(a,b,d){if(a)return b=k[b],vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.setMode]: (Attempting to "+(d==vga.irc.roleModeAction.add?"add":"remove")+" the mode "+b+" on channel: "+a+")."),this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+a+" "+(d==vga.irc.roleModeAction.add?"+":"-")+b}),this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.setMode]: (Invalid channel "+a+").");return this};vga.irc.connector.kiwi.connector.prototype.setUserStatus=
function(a,b,d,f,g){if(a){var c="";vga.irc.bitArray.contains(d,vga.irc.status.banned)&&(b=vga.irc.connector.kiwi.banMaskToApply.replace("{identity}",""+b+(this._consolidateNicknames?"":"*")),vga.irc.bitArray.contains(d,vga.irc.status.timed)?(c="tb",d=(g||{duration:0}).duration||900,this._protocol&&this._protocol.sendIRCData("raw",{data:"TBAN "+a+" "+d+" m:"+b})):(c="b",this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+a+" "+(f==vga.irc.roleModeAction.add?"+":"-")+c+" "+b})));vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.setUserStatus]: (Attempting to "+
(f==vga.irc.roleModeAction.add?"add":"remove")+" the status "+c+" on channel: "+a+").");return this}vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.setMode]: (Invalid channel "+a+").");return this};vga.irc.connector.kiwi.connector.prototype.setNickname=function(a){a&&(this._nickname=a,vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.nick]: (Attempting to change nickname to: "+a+")."),this._protocol&&this._protocol.sendIRCData("nick",{nick:a}));return this};vga.irc.connector.kiwi.connector.prototype.kick=
function(a,b){a&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.nick]: (Attempting to kick: "+b+")."),this._protocol&&this._protocol.sendIRCData("kick",{channel:a,nick:b,reason:"Bye!"}));vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.setMode]: (Invalid channel "+a+").");return this};vga.irc.connector.kiwi.connector.prototype.disconnect=function(a){this._nickname=this._identity="";this._protocol&&(vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.disconnect]: (Attempting to disconnect with message: "+
(a||"undefined")+")."),this._protocol.sendIRCData("quit",{message:a}),this._protocol.close(a));return this};vga.irc.connector.kiwi.connector.prototype.dispose=function(){this.disconnect();this._protocol=vga.util.safeDispose(this._protocol);return this};vga.irc.connector.kiwi.connector.prototype.onConnect=function(a){var c="";this._numberOfReconnectsAttempted=0;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onConnect]: (AutoJoinChannel: "+(""!==this._autoJoinChannel?this._autoJoinChannel:
"none")+", Nick: "+a.nick+").");""!==this._autoJoinChannel&&(this.join(this._autoJoinChannel),c=this._autoJoinChannel);this._listener.invokeListeners("connect",{channelKey:c})};vga.irc.connector.kiwi.connector.prototype.onDisconnect=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onDisconnected]: (Reason: '"+a.reason+"', closedByServer: "+a.closedByServer+", existingConnection: "+a.existingConnection+").");var c="Unable to reach the server.  Try again later.";if(this._attemptReconnect&&
a.closedByServer&&a.existingConnection){if(this._numberOfReconnectsAttempted<this._maxNumberOfReconnectAttempts){this._numberOfReconnectsAttempted++;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onDisconnected]: (Attempt to reconnect is enabled, attempting try: "+this._numberOfReconnectsAttempted+").");this._listener.invokeListeners("reconnect");return}c="(Exceeded the number of retry event: "+this._maxNumberOfReconnectAttempts+"). Giving up.";vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onDisconnected]: "+
c)}this._protocol&&this._protocol.close();this._listener.invokeListeners("disconnect",{closedByServer:a.closedByServer,reason:c})};vga.irc.connector.kiwi.connector.prototype.onOptions=function(a){var c=this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onOptions].");0===vga.util.propertyCount(this._prefixMap)&&a.options&&a.options.PREFIX&&a.options.PREFIX.forEach(function(a){a.symbol&&a.mode&&(c._prefixMap[a.symbol]=a.mode)})};vga.irc.connector.kiwi.connector.prototype.onNick=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onNick].",
a);var c=this.normalizeNickname(a.nick);if(c=this.isMe(c))this._nickname=a.newnick;var b=this.normalizeNickname(a.newnick);this._listener.invokeListeners("nick",{userKey:this.generateUserKey(a.nick),newUserKey:this.generateUserKey(a.newnick),identity:b,nickname:a.nick,newNickName:a.newnick,isMe:c})};vga.irc.connector.kiwi.connector.prototype.onMessage=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onMessage]: (Target: "+a.target+", Type: "+a.type+", Nickname: "+a.nick+", Message: "+
a.msg+").");var c=0<a.target.length&&"#"===a.target[0];"message"!==a.type&&"action"!==a.type||this._listener.invokeListeners("message",{userKey:this.generateUserKey(a.nick),identity:this.normalizeNickname(a.nick),nickname:a.nick,isChannel:c,target:c?this.generateChannelKey(a.target):this.generateUserKey(a.target),message:a.msg,type:a.type})};vga.irc.connector.kiwi.connector.prototype.onTopic=function(a){var c=this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onTopic]: (Topic: "+
a.topic+", Channel: "+c+").");this._listener.invokeListeners("topic",{topic:a.topic,channelKey:c})};vga.irc.connector.kiwi.connector.prototype.onChannel=function(a){var c=this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onChannel]: (Channel: "+c+", Identity: "+a.ident+", Type: "+a.type+").");var b="kick"!==a.type?a.nick:a.kicked,d=this.normalizeNickname(b),f=this.isMe(b);this._autoJoinChannelComplete="join"===a.type&&c===this._autoJoinChannel&&f;"join"===
a.type?(f&&this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+this._autoJoinChannel}),this._knownIdentities.add(d)):"part"===a.type&&this._knownIdentities.delete(d);this._listener.invokeListeners(""+a.type,{channelKey:c,userKey:this.generateUserKey(b),identity:d,nickname:b,isMe:this.isMe(d)})};vga.irc.connector.kiwi.connector.prototype.onChannelInfo=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onChannelInfo]: (Channel: "+a.channel+").");if(a.modes){var c=vga.irc.channelmodes.none;
a.modes.forEach(function(a){a&&"+"===a.mode.substring(0,1)&&(c=vga.irc.bitArray.add(c,d[a.mode.substring(1,2)]))});this._listener.invokeListeners("channelmode",{channelKey:this.generateChannelKey(a.channel),action:vga.irc.roleModeAction.add,modes:c})}};vga.irc.connector.kiwi.connector.prototype.onQuit=function(a){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onQuit]: (Nick: "+a.nick+", Identity: "+a.ident+", Message: "+a.message+").");var c=this.normalizeNickname(a.nick);this._listener.invokeListeners("quit",
{userKey:this.generateUserKey(a.nick),identity:c,nickname:a.nick,isMe:this.isMe(c)});this._knownIdentities.delete(c)};vga.irc.connector.kiwi.connector.prototype.onMode=function(a){var c=this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onMode].");0!==a.modes.length&&a.modes.forEach(function(b){var f=(b.mode||"").trim();if(0!==f.length){var h=vga.irc.roleModeAction.add;1<f.length&&(h="-"===f.substring(0,1)?vga.irc.roleModeAction.remove:vga.irc.roleModeAction.add,f=f.substring(1,2));var g=
c.generateChannelKey(a.target);if(null!==b.param)c.onUserMode(g,b.param,h,f);else c._listener.invokeListeners("channelmode",{channelKey:g,action:h,modes:vga.irc.bitArray.compileBitArray([f],function(a){return d[a]})})}})};vga.irc.connector.kiwi.connector.prototype.onUserMode=function(a,b,d,k){a={channelKey:a,action:d};if(g[k]){k=g[k];if(k===vga.irc.status.banned){d=vga.irc.connector.kiwi.banMaskRegEx.exec(b);(null===d||4>d.length)&&vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onMode]: Invalid banmask: "+
b);b=d[2];d=d[3];if("*"===b.trim()&&"*"===d.trim())return;if("*"===b)if(-1<d.indexOf("*")){var c=new RegExp(d.replace("*",vga.irc.connector.kiwi.wildCardMaskRegString),"i"),h=[];this._knownIdentities.forEach(function(a){c.test(a)&&h.push(a)});var l=c.test(this.getMyNickname());a.identities=h}else b=d}d="status";a.status=k}else d="role",a.roles=vga.irc.bitArray.compileBitArray([k],function(a){return f[a]},vga.irc.roles.shadow);k=this.normalizeNickname(b);a.userKey=this.generateUserKey(b);a.identity=
k;a.nickname=b;a.isMe=void 0!==l?l:this.isMe(k);this._listener.invokeListeners(d,a)};vga.irc.connector.kiwi.connector.prototype.onUserlist=function(a){var c=this;vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onUserlist].");var d=0<vga.util.propertyCount(this._prefixMap)?this._prefixMap:b,g=this.generateChannelKey(a.channel),k=this._userListByChannel[g];k||(this._userListByChannel[g]=k={});a.users.forEach(function(a){for(var b=[],h=0,g=0;g<a.nick.length&&d.hasOwnProperty(a.nick[g]);g++)b.push(d[a.nick[g]]),
h++;b=a.nick.substring(h);h=c.normalizeNickname(b);g=c.generateUserKey(b);c._knownIdentities.add(h);var l=k[g];l?l.addNickname(b):(a=vga.irc.bitArray.compileBitArray(a.modes,function(a){return f[a]},vga.irc.roles.shadow),k[g]=new vga.irc.userEntity(h,[b],a))})};vga.irc.connector.kiwi.connector.prototype.onUserlistEnd=function(a){a=this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onUserListEnd]: Channel: "+a);this._userListByChannel&&a&&this._userListByChannel.hasOwnProperty(a)&&
(vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onUserListEnd]: (UserList: "+this._userListByChannel[a].users+")."),this._listener.invokeListeners("userlist",{users:this._userListByChannel[a],channelKey:a}))};vga.irc.connector.kiwi.connector.prototype.onError=function(b){vga.util.debuglog.info("[vga.irc.connector.kiwi.connector.onError]: (Error: "+b.error+", Reason: "+b.reason+").");switch(b.error){case "nickname_in_use":if(this._supportConcurrentChannelJoins){this.setNickname(a(this._nickname));
return}break;case "erroneus_nickname":this.setNickname("_"+this._nickname);return;case "cannot_send_to_channel":return;case "banned_from_channel":this._listener.invokeListeners("banned",{userKey:this.getMyUserKey(),channelKey:this.generateChannelKey(b.channel)});return;case "chanop_privs_needed":return;case "password_mismatch":this._listener.invokeListeners("accessdenied");return;case "error":if(vga.irc.connector.kiwi.accessDeniedRegEx.test(b.reason)){this._listener.invokeListeners("accessdenied");
this._protocol&&this._protocol.close();return}}this._listener.invokeListeners("error",{reason:b.reason})}})();vga=vga||{};vga.irc=vga.irc||{};
$(function(){function a(a){switch(vga.irc.getMostSignificantRole(a)){case vga.irc.roles.owner:case vga.irc.roles.admin:return"crew";case vga.irc.roles.mod:return"mod";case vga.irc.roles.guest:return"guest";case vga.irc.roles.turbo:return"turbo";default:return"shadow"}}function b(a){return vga.irc.getMostSignificantRole(a)>=vga.irc.roles.mod}function f(a){$("#login-wrapper").toggleClass("hidden",!a);a&&x.focus()}function g(a){$(".spinner").toggleClass("hidden",!a);$("#vgairc_loginform").toggleClass("hidden",a)}
function d(a,b){var e=$("#slide_message");e.text(a||"").toggleClass("hidden",!a);g(!1);b&&setTimeout(function(){e.fadeOut("slow",function(){e.toggleClass("hidden",!0).css("display","")})},b)}function k(a){if(!a)return $("");var e=q.find("#channel-tab-"+a.replace("#",""));if(0===e.length){var b=q.find("#channel-tab-template");e=b.clone();e.attr("id","channel-tab-"+a.replace("#","")).removeClass("hidden").data("channel",a).data("channel",a);b.addClass("hidden");q.append(e)}return e}function p(a){$.each(q.find(".channel-tab").not(a),
function(a,e){a=$(e);a.addClass("hidden");h(a,!1)});a.removeClass("hidden");h(a,!0)}function c(a){return k(a).find(".channel-window")}function h(a,b){a.find(".user-list-button").toggleClass("disabled",!b);a=a.find(".chatbox");a.prop("disabled",!b);b&&a.focus()}function l(a,b){var e=c(a);Array.isArray(b)?b.forEach(function(a){e.append('<div class="informative"><span class="message">'+vga.util.encodeHTML(a)+"</span></div>")}):e.append('<div class="informative text-center"><span class="message">'+vga.util.encodeHTML(b)+
"</span></div>")}function t(e,b){e=c(e).find(".user-entry[data-identity="+b.identity+"]");vga.irc.getMostSignificantStatus(b.status)===vga.irc.status.banned?e.remove():(b=a(b.roles),e.find(".role").removeClass().addClass("role "+b).find(".icon").attr("title",b))}function u(e){var b="";e.nicknames.forEach(function(a){b+=""+(0<b.length?",":"")+a});var c=vga.irc.getMostSignificantStatus(e.status)===vga.irc.status.banned?"banned":"";c=c?c:a(e.roles);return"<div data-identity='"+e.identity+"' class='user-entry'><div class='role "+
c+"'>"+('<div class="icon" title="'+c+'"></div>')+("<div class='username' title=\"Nicknames: "+b+'">'+e.identity+"</div>")+"</div></div>"}function v(a){a.html(a.find("div[data-identity]").sort(function(a,e){a=($(a).data("identity")||"").toLowerCase();e=($(e).data("identity")||"").toLowerCase();return a<e?-1:a>e?1:0}))}function r(a,c){var e=k(a).find(".user-list-wrapper .user-list");a=e.find(".mod-section-body");var m=e.find(".guest-section-body"),d=e.find(".regular-section-body");e=e.find(".user-entry[data-identity="+
c.identity+"]");if(0===c.nicknames.length)e.remove();else{var f=d;b(c.roles)?f=a:vga.irc.getMostSignificantRole(c.roles)===vga.irc.roles.guest&&(f=m);0!==e.length&&e.remove();f.append(u(c));v(f)}a.parent().toggleClass("hidden",0==a.find("div").length);m.parent().toggleClass("hidden",0==m.find("div").length);d.parent().toggleClass("hidden",0==d.find("div").length)}function z(a,c){a=k(a).find(".user-list-wrapper .user-list");var e=a.find(".mod-section-body"),m=a.find(".guest-section-body"),d=a.find(".regular-section-body");
e.html("");m.html("");d.html("");c&&vga.util.forEach(c,function(a,c){a=d;b(c.roles)?a=e:vga.irc.getMostSignificantRole(c.roles)===vga.irc.roles.guest&&(a=m);a.append(u(c));v(a)});e.parent().toggleClass("hidden",0===e.find("div").length);m.parent().toggleClass("hidden",0===m.find("div").length);d.parent().toggleClass("hidden",0===d.find("div").length)}var q=$(".channel-container"),w=$("#settings-container"),A=$("#channel"),x=$("#nickname"),B=$("#password");vga.irc.chat=function(a){a=a||{};if(!a.url)throw new vga.util.exception("irc.chat",
"The url cannot be empty.");if(!a.hostname)throw new vga.util.exception("irc.chat","The hostname must be set.");if(!a.port)throw new vga.util.exception("irc.chat","The port must be set.");vga.irc.chat.CLIENT_VERSION=new vga.util.version(1,1,0);this._userChannels={};this._smoothScrollState=vga.irc.smoothScrollState.stopped;this._hostname=a.hostname;this._port=a.port;this._ssl=void 0===a.ssl?!1:a.ssl;this._debug=void 0==a.debug?!1:a.debug;this._wallRegEx=a.wallRegEx||/^%! ([^\r\n]*)/;this._defaultChannel=
a.defaultChannel;this._themes=a.themes||[];this._showUserJoinLeaveMessage=void 0!==a.showUserJoinLeaveMessage?a.showUserJoinLeaveMessage:!1;this._smoothScroll=void 0!==a.smoothScroll?a.smoothScroll:!0;this._timedBanDurationInSeconds=void 0!==a.timedBanDurationInSeconds?a.timedBanDurationInSeconds:300;this._nicknameColorSeedFunction=a.nicknameColorSeedFunction;this._hyperlinkRegEx=a.hyperlinkRegEx||/https?:\/\/[\w.\/?&#%=\-,+@!:\[\]\(\)\$';]+/ig;var e=void 0!==a.consolidateNicknames?a.consolidateNicknames:
!1,b=void 0!==a.enableReconnect?a.enableReconnect:!0,c=!this._defaultChannel;void 0!==a.enableFrashShowMode&&a.enableFrashShowMode&&this.setFrashShowMode(!0);this._debug&&vga.util.enableDebug();this.bindEvents();this.onLoadSettings();console.log("[vga.irc.chat]: Starting chat version: "+vga.irc.chat.CLIENT_VERSION.toString());this.connector=new vga.irc.connector.kiwi.connector(a.url,{supportConcurrentChannelJoins:a.supportConcurrentChannelJoins,autoJoinChannel:c,attemptReconnect:b,consolidateNicknames:e,
listeners:[this]})};vga.irc.chat.prototype.writeMessage=function(e,m,d,f){f=f||"message";var y=""+("action"===f?"allowColor":""),h="",g=this._userChannels[e];g&&(g=g[this.connector.getMyUserKey()])&&b(g.roles)&&(h='<span class="timeout"><i class="fa fa-ban" role="button" title="Timeout Chatter!"></i></span>');this._wallRegEx.test(d)&&b(m.roles)&&(g=this._wallRegEx.exec(d),1<g.length&&(d=g[1],y="modbroadcast"));if(!this._frashShowMode&&this._hyperlinkRegEx&&this._hyperlinkRegEx.test(d)){g="";var k=
0,n;for(this._hyperlinkRegEx.lastIndex=0;(n=this._hyperlinkRegEx.exec(d))&&!(g+=vga.util.encodeHTML(d.substring(k,n.index)),k=d.substr(n.index,n[0].length),g+="<a href='"+k+"' target='_blank'>"+vga.util.encodeHTML(k)+"</a>",k=this._hyperlinkRegEx.lastIndex||0,0>this._hyperlinkRegEx.flags.indexOf("g")););d=g.trim()}else d=vga.util.encodeHTML(d).trim();g=void 0!==m?m.identity.trim():"undefined";k=a(void 0!==m?m.roles:vga.irc.roles.shadow);m=m.identity;n=this._nicknameColorSeedFunction&&this._nicknameColorSeedFunction()||
0;for(var l=0;l<m.length;l++)n+=m.charCodeAt(l);m=""+(n%7+1);n=g;"privateTO"===f?n="To ["+n+"]":"privateFROM"===f&&(n="From ["+n+"]");n=(n[0]||"").toLocaleUpperCase()+n.substring(1);c(e).append("<div class='user-entry nickColor"+m+"' data-identity='"+g+"'><div class='role "+k+"'>"+('<div class="icon" title="'+k+'"></div>'+h)+("<span class='username allowColor'>"+n.trim()+("action"!==f?":&nbsp":"&nbsp")+"</span>")+("<span class='message "+y+"'>"+d+"</span>")+"</div></div>")};vga.irc.chat.prototype.showToggleSetting=
function(a,b){w.find(".settings-item[data-settings-type='"+a+"']").toggleClass("hidden",!b)};vga.irc.chat.prototype.toggleSettingItem=function(a,b){w.find(".settings-item[data-settings-type='"+a+"'] > i").toggleClass("fa-toggle-off",!b).toggleClass("fa-toggle-on",b)};vga.irc.chat.prototype.setFrashShowMode=function(a){this._frashShowMode=a;this.showToggleSetting("join-mode",!a);this.showToggleSetting("frash-show-mode",!0);this.toggleSettingItem("frash-show-mode",a);$("html").toggleClass("frash-show-mode",
a)};vga.irc.chat.prototype.startThemes=function(){var a=this,b=function(){a._themesIntervalId=setTimeout(function(){var e=new Date;a._themes.forEach(function(a){var b=new Date(a.beginDate),c=new Date(a.endDate);b.setFullYear(e.getFullYear());c.setFullYear(e.getFullYear());$("body").toggleClass(a.name,e>=b&&e<=c)});b()},1E3)};b()};vga.irc.chat.prototype.stopThemes=function(){clearTimeout(this._themesIntervalId)};vga.irc.chat.prototype.startSmoothScrolling=function(){var a=this,b=function(){a._smoothScrollState!==
vga.irc.smoothScrollState.stopped&&(a._smoothScrollIntervalId=setTimeout(function(){if(a._smoothScrollState===vga.irc.smoothScrollState.started){var e=q.find(":not(#channel-tab-template)").find(".channel-window");$.each(e,function(e,b){e=$(b).prop("scrollHeight");if(a._smoothScroll){var c=$(b).prop("scrollTop"),d=c+$(b).height(),m=1;d<e-140&&(m=Math.round(1+(e-d)/50));e=c+m}$(b).scrollTop(e)})}b()},33))};this._smoothScrollState=vga.irc.smoothScrollState.started;b()};vga.irc.chat.prototype.stopSmoothScrolling=
function(){this._smoothScrollState=vga.irc.smoothScrollState.stopped;clearTimeout(this._smoothScrollIntervalId)};vga.irc.chat.prototype.pauseSmoothScrolling=function(a){this._smoothScrollState!==vga.irc.smoothScrollState.stopped&&(this._smoothScrollState=a?vga.irc.smoothScrollState.paused:vga.irc.smoothScrollState.started)};vga.irc.chat.prototype.connect=function(a,b,c){this.connector.connect({nick:a.trim(),hostname:this._hostname,port:this._port,ssl:this._ssl,password:b.trim(),channel:(c||this._defaultChannel||
"").trim()});return this};vga.irc.chat.prototype.close=function(a){this.connector&&this.connector.disconnect(a);return this};vga.irc.chat.prototype.send=function(a,b){return a?"/"===b[0]?(b=b.splitFirstOccurrence(" "),this.handleUserCommand(a,b.first.trim().toLowerCase(),b.second)):this.handleUserMessage(a,b):this};vga.irc.chat.prototype.join=function(a){this._userChannels[a]?p(k(a)):this.connector&&this.connector.join(a);return this};vga.irc.chat.prototype.leave=function(a,b){this._userChannels[a]&&
(this.connector&&this.connector.leave(a,b),vga.util.forEach(this._userChannels,function(a,b){}),p(k(a)));return this};vga.irc.chat.prototype.emote=function(a,b){this.connector.emote(a,b);var e=this._userChannels[a];e&&(e=e[this.connector.getMyUserKey()],this.writeMessage(a,e,b,"action"))};vga.irc.chat.prototype.whisper=function(a,b,c){this.connector&&this.connector.send(b,c);var e=this._userChannels[a];e&&((e=e[b.toLowerCase()])?this.writeMessage(a,e,""+c,"privateTO"):l(a,"The user '"+b+"' was not found."))};
vga.irc.chat.prototype.help=function(a){l(a,"The following commands are available:;USAGE NOTE: Command [Alias] argument (optional argument);EXAMPLE USAGE(1): /emote dances.;EXAMPLE USAGE(2): /tell cafftest Hello.;/help [/h /?] -- Help information, this screen.;/quit [/q] (message) -- Quits the chat with an optional message.;/join #channelName -- Joins a specific channel.;/leave (message) -- Leaves the current channel tab with an optional message.;/emote [/me /e /em] emote -- Performs an emote on the current channel.;/whisper [/tell /r] nickname message -- Sends a private message to the nickname.".split(";"))};
vga.irc.chat.prototype.handleUserMessage=function(a,b){this.connector&&this.connector.send(a,b);var e=this._userChannels[a];e&&(e=e[this.connector.getMyUserKey()],this.writeMessage(a,e,b));return this};vga.irc.chat.prototype.handleUserCommand=function(a,b,c){switch(b){case "/quit":case "/q":this.close(c||"Bye VGA Webchat");break;case "/join":this.join(c);break;case "/leave":this.leave(a,c);break;case "/me":case "/e":case "/em":case "/emote":this.emote(a,c);break;case "/r":case "/whisper":case "/tell":b=
c.splitFirstOccurrence(" ");this.whisper(a,b.first,b.second);break;case "/help":case "/h":case "/?":this.help(a)}return this};vga.irc.chat.prototype.setTurboMode=function(a,b){this.connector&&(this.connector.setMode("#"+a,vga.irc.channelmodes.turbo,b?vga.irc.roleModeAction.add:vga.irc.roleModeAction.remove),this.toggleSettingItem("turbo-mode",b));return this};vga.irc.chat.prototype.setTimedBan=function(a,b,c){if(this.connector){var e=vga.irc.bitArray.add(0,vga.irc.status.banned|vga.irc.status.timed);
this.connector.setUserStatus(a,b,e,c?vga.irc.roleModeAction.add:vga.irc.roleModeAction.remove,{duration:this._timedBanDurationInSeconds})}return this};vga.irc.chat.prototype.onConnect=function(a){d();f(!1);this.startSmoothScrolling();this.startThemes();l(a.channelKey,"VGA Chat version:"+vga.irc.chat.CLIENT_VERSION.toString())};vga.irc.chat.prototype.onDisconnect=function(a){this.stopSmoothScrolling();this.stopThemes();f(!0);a.closedByServer&&d(a.reason,5E3);vga.util.forEach(this._userChannels,function(b,
e){e=k(b);h(e,!1);c(b).toggleClass("pulse",!1);l(b,a.closedByServer?"Disconnected by the server.":"You have quit.")})};vga.irc.chat.prototype.onReconnect=function(){d("The server stopped responding...retrying.",5E3);this.onLogin()};vga.irc.chat.prototype.onTopic=function(a){l(a.channelKey,a.topic)};vga.irc.chat.prototype.onChannelMode=function(a){var b=this._userChannels[a.channelKey];if(b){var e=k(a.channelKey);a.modes===vga.irc.channelmodes.turbo&&(this.toggleSettingItem("turbo-mode",a.action===
vga.irc.roleModeAction.add),a.action===vga.irc.roleModeAction.add?(l(a.channelKey,"The room is now in TURBO only mode."),a=b[this.connector.getMyUserKey()],e.find("input.chatbox").prop("disabled",vga.irc.getMostSignificantRole(a.roles)===vga.irc.roles.shadow)):(l(a.channelKey,"The room is now free for all chatters."),e.find("input.chatbox").prop("disabled",!1)))}};vga.irc.chat.prototype.onNick=function(a){vga.util.forEach(this._userChannels,function(b,e){var c=e[a.userKey];c&&(c.identity=a.identity,
c.removeNickname(a.nickname).addNickname(a.newNickName));a.userKey!==a.newUserKey&&(e[a.newUserKey]=c,e[a.userKey]=void 0);r(b,c);t(b,c)})};vga.irc.chat.prototype.onMessage=function(a){var b=this;if(!this._wallRegEx.test(a.message)||!this._frashShowMode){var e=function(e,c,d){c&&b.writeMessage(e,c[a.userKey],a.message,d)};a.isChannel?e(a.target,this._userChannels[a.target],a.type):vga.util.forEach(this._userChannels,function(a,b){e(a,b,"privateFROM")})}};vga.irc.chat.prototype.onUserlist=function(a){this._userChannels[a.channelKey]=
a.users;z(a.channelKey,a.users)};vga.irc.chat.prototype.onJoin=function(a){if(a.isMe){var b=k(a.channelKey);p(b);c(a.channelKey).toggleClass("pulse",!1);l(a.channelKey,"Joined "+a.channelKey+" channel.")}else if(b=this._userChannels[a.channelKey]){var e=b[a.userKey];e||(e=new vga.irc.userEntity(a.identity,a.nickname),b[a.userKey]=e,this._frashShowMode||!this._showUserJoinLeaveMessage||a.isMe||this.writeMessage(a.channelKey,e,"has joined.","action"));e.addNickname(a.nickname);r(a.channelKey,e)}};vga.irc.chat.prototype.onLeave=
function(a){if(a.isMe)l(a.channelKey,"Left "+a.channelKey+" channel."),delete this._userChannels[a.channelKey],(a=Object.getOwnPropertyNames(this._userChannels).pop())?(a=k(a),p(a)):this.close("Bye VGA Webchat");else{var b=this._userChannels[a.channelKey];if(b){var c=b[a.userKey];c&&(c.removeNickname(a.nickname),0===c.nicknames.length&&(b[a.userKey]=void 0,this._frashShowMode||!this._showUserJoinLeaveMessage||a.isMe||this.writeMessage(a.channelKey,c,"has left.","action")),r(a.channelKey,c))}}};vga.irc.chat.prototype.onQuit=
function(a){var b=this;vga.util.forEach(this._userChannels,function(c,e){b.onLeave({channelKey:c,userKey:a.userKey,nickname:a.nickname,isMe:a.IsMe})})};vga.irc.chat.prototype.onRole=function(a){var c=this._userChannels[a.channelKey];if(c){var e=c[a.userKey];e&&(e.applyRoles(a.action,a.roles),r(a.channelKey,e),t(a.channelKey,e),a.isMe&&(a=c[this.connector.getMyUserKey()],this.showToggleSetting("turbo-mode",a&&b(a.roles))))}};vga.irc.chat.prototype.onStatus=function(a){var b=this._userChannels[a.channelKey];
if(b){var c=function(c){if(c=b[c])c.applyStatus(a.action,a.status),r(a.channelKey,c),t(a.channelKey,c)};if("*"===a.userKey&&a.identities)for(var e=$jscomp.makeIterator(a.identities),d=e.next();!d.done;d=e.next())c(d.value);else c(a.userKey);a.isMe&&a.status===vga.irc.status.banned&&l(a.channelKey,a.action===vga.irc.roleModeAction.add?"You have been timed out.":"Your timeout has expired.")}};vga.irc.chat.prototype.onAccessDenied=function(){d("Invalid login, please try again")};vga.irc.chat.prototype.onKicked=
function(a){a.isMe&&(this.close(),d("You have been kicked."))};vga.irc.chat.prototype.onBanned=function(a){this.close();d("You have been banned.")};vga.irc.chat.prototype.onError=function(a){d("Sorry, an unknown error has occured.");vga.util.debuglog.error(a.reason)};vga.irc.chat.prototype.bindEvents=function(){var a=this;$("#vgairc_loginform").off().on("submit",function(b){a.onLogin();b.preventDefault();setTimeout(function(){history.replaceState({success:!0},"title")},100)}).on("keyup","input",function(b){if(13===
b.which)a.onLogin()});q.off().on("keyup","input",function(b){a.onSendCommandMessage($(b.currentTarget),b.which)}).on("click",".user-list-button",function(b){a.onUserListToggle($(b.currentTarget));b.preventDefault()}).on("click",".user-settings-button",function(b){a.onGlobalSettingsMenu($(b.currentTarget));b.preventDefault()}).on("click",".settings-item",function(b){a.onSettingsItemToggle($(b.currentTarget));b.preventDefault()}).on("mouseenter mouseleave",".channel-window",function(b){a.onChannelWindowHover("mouseenter"===
b.type)}).on("click",".timeout",function(b){a.onTimeoutUser($(b.currentTarget));b.preventDefault()})};vga.irc.chat.prototype.onLogin=function(){var a=(A.val()||this._defaultChannel||"").trim();g(!0);c(a).toggleClass("pulse",!0);this.connect(x.val(),B.val(),a)};vga.irc.chat.prototype.onUserListToggle=function(a){a.hasClass("disabled")||(a=a.parents(".channel-tab").find(".user-list-wrapper"),a.toggleClass("hidden",!a.hasClass("hidden")))};vga.irc.chat.prototype.onGlobalSettingsMenu=function(a){a=$("#settings-container");
a.toggleClass("hidden",!a.hasClass("hidden"))};vga.irc.chat.prototype.onLoadSettings=function(){var a="true"===vga.util.readCookie("join-mode","false"),b="true"===vga.util.readCookie("smooth-scroll-mode","true");this._showUserJoinLeaveMessage=a;this._smoothScroll=b;this.toggleSettingItem("join-mode",a);this.toggleSettingItem("smooth-scroll-mode",b)};vga.irc.chat.prototype.onSettingsItemToggle=function(a){var b=a.find("i"),c=!b.hasClass("fa-toggle-on");switch(a.data("settings-type")){case "frash-show-mode":this.setFrashShowMode(c);
break;case "turbo-mode":a=a.data("channels");this.setTurboMode(a,c);break;case "join-mode":this._showUserJoinLeaveMessage=c;b.toggleClass("fa-toggle-off",!c).toggleClass("fa-toggle-on",c);vga.util.setCookie("join-mode",c);break;case "smooth-scroll-mode":this._smoothScroll=c,b.toggleClass("fa-toggle-off",!c).toggleClass("fa-toggle-on",c),vga.util.setCookie("smooth-scroll-mode",c)}};vga.irc.chat.prototype.onTimeoutUser=function(a){var b=a.parents(".user-entry");a=b.parents(".channel-tab");b=b.data("identity");
a=a.data("channel");b&&a&&this.setTimedBan(a,b,!0)};vga.irc.chat.prototype.onChannelWindowHover=function(a){this.pauseSmoothScrolling(a)};vga.irc.chat.prototype.onSendCommandMessage=function(a,b){var c=a.val();13===b&&""!==c&&(a.val(""),a=a.parents(".channel-tab").data("channel"),this.send(a,c))}}());
