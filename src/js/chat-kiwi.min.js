var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,h){a!=Array.prototype&&a!=Object.prototype&&(a[c]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var c=a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};
$jscomp.polyfill=function(a,c,h,k){if(c){h=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var d=a[k];d in h||(h[d]={});h=h[d]}a=a[a.length-1];k=h[a];c=c(k);c!=k&&null!=c&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("WeakMap",function(a){function c(a){$jscomp.owns(a,k)||$jscomp.defineProperty(a,k,{value:{}})}function h(a){var b=Object[a];b&&(Object[a]=function(g){c(g);return b(g)})}if(function(){if(!a||!Object.seal)return!1;try{var d=Object.seal({}),b=Object.seal({}),g=new a([[d,2],[b,3]]);if(2!=g.get(d)||3!=g.get(b))return!1;g.delete(d);g.set(b,4);return!g.has(d)&&4==g.get(b)}catch(n){return!1}}())return a;var k="$jscomp_hidden_"+Math.random().toString().substring(2);h("freeze");h("preventExtensions");
h("seal");var d=0,e=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};e.prototype.set=function(a,b){c(a);if(!$jscomp.owns(a,k))throw Error("WeakMap key fail: "+a);a[k][this.id_]=b;return this};e.prototype.get=function(a){return $jscomp.owns(a,k)?a[k][this.id_]:void 0};e.prototype.has=function(a){return $jscomp.owns(a,k)&&$jscomp.owns(a[k],this.id_)};e.prototype.delete=
function(a){return $jscomp.owns(a,k)&&$jscomp.owns(a[k],this.id_)?delete a[k][this.id_]:!1};return e},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),g=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=g.get(b)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var n=g.entries(),d=n.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=n.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!n.next().done?!1:!0}catch(v){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var c=new WeakMap,h=function(b){this.data_={};this.head_=e();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)a=a.value,this.set(a[0],a[1])}};h.prototype.set=function(b,a){var g=k(this,b);g.list||(g.list=this.data_[g.id]=[]);g.entry?g.entry.value=a:(g.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:a},g.list.push(g.entry),this.head_.previous.next=g.entry,this.head_.previous=g.entry,this.size++);return this};h.prototype.delete=
function(b){b=k(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};h.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};h.prototype.has=function(b){return!!k(this,b).entry};h.prototype.get=function(b){return(b=k(this,b).entry)&&b.value};h.prototype.entries=function(){return d(this,function(b){return[b.key,
b.value]})};h.prototype.keys=function(){return d(this,function(b){return b.key})};h.prototype.values=function(){return d(this,function(b){return b.value})};h.prototype.forEach=function(b,a){for(var g=this.entries(),d;!(d=g.next()).done;)d=d.value,b.call(a,d[1],d[0],this)};h.prototype[Symbol.iterator]=h.prototype.entries;var k=function(b,a){var g=a&&typeof a;"object"==g||"function"==g?c.has(a)?g=c.get(a):(g=""+ ++l,c.set(a,g)):g="p_"+a;var d=b.data_[g];if(d&&$jscomp.owns(b.data_,g))for(b=0;b<d.length;b++){var h=
d[b];if(a!==a&&h.key!==h.key||a===h.key)return{id:g,list:d,index:b,entry:h}}return{id:g,list:d,index:-1,entry:void 0}},d=function(b,a){var g=b.head_;return $jscomp.iteratorPrototype(function(){if(g){for(;g.head!=b.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:a(g)};g=null}return{done:!0,value:void 0}})},e=function(){var b={};return b.previous=b.next=b.head=b},l=0;return h},"es6","es3");
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),k=new a($jscomp.makeIterator([c]));if(!k.has(c)||1!=k.size||k.add(c)!=k||1!=k.size||k.add({x:4})!=k||2!=k.size)return!1;var d=k.entries(),e=d.next();if(e.done||e.value[0]!=c||e.value[1]!=c)return!1;e=d.next();return e.done||e.value[0]==c||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:d.next().done}catch(l){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)this.add(c.value)}this.size=this.map_.size};c.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};
c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,c){var d=this;this.map_.forEach(function(e){return a.call(c,e,e,d)})};return c},"es6","es3");$jscomp.findInternal=function(a,c,h){a instanceof String&&(a=String(a));for(var k=a.length,d=0;d<k;d++){var e=a[d];if(c.call(h,e,d,a))return{i:d,v:e}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6","es3");var vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.roles={owner:32,admin:16,mod:8,guest:4,turbo:2,shadow:1,none:0};vga.webchat.status={muted:4,timed:2,banned:1,nominal:0};vga.webchat.roleModeAction={remove:0,add:1};vga.webchat.channelmodes={turbo:1,none:0};vga.webchat.smoothScrollState={stopped:0,started:1,paused:2};vga.webchat.messageType={message:0,action:1,whisper:2};
vga.webchat.bitArray=vga.webchat.bitArray||{};vga.webchat.bitArray.getMostSignificantValue=function(a,c,h){for(c=vga.util.propertyCount(c)-1;0<=c;c--){var k=1<<c;if((a&k)===k)return k}return h};vga.webchat.bitArray.add=function(a,c){return a|c};vga.webchat.bitArray.remove=function(a,c){return a^a&c};vga.webchat.bitArray.contains=function(a,c){return a&c===c};
vga.webchat.bitArray.compileBitArray=function(a,c,h){a=a||[];if(!c)throw new "The transformFunction is undefined.";h=void 0!==h?h:0;return 0===a.length?h:1===a.length?h|(c(a[0])||0):a.reduce(function(a,d){return a|(c[d]||0)},h)};vga.webchat.getMostSignificantRole=function(a){return vga.webchat.bitArray.getMostSignificantValue(a,vga.webchat.roles,vga.webchat.roles.shadow)};vga.webchat.getMostSignificantStatus=function(a){return vga.webchat.bitArray.getMostSignificantValue(a,vga.webchat.status,vga.webchat.status.nominal)};vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.userEntity=function(a,c,h){this.roles=void 0!==h?h:vga.webchat.roles.shadow;this.status=vga.webchat.status.nominal;this.identity=a;this.nicknames=void 0!==c?Array.isArray(c)?c:[c]:[]};vga.webchat.userEntity.prototype.applyRoles=function(a,c){this.roles=a===vga.webchat.roleModeAction.add?vga.webchat.bitArray.add(this.roles,c):vga.webchat.bitArray.remove(this.roles,c);return this};
vga.webchat.userEntity.prototype.applyStatus=function(a,c){this.status=a===vga.webchat.roleModeAction.add?vga.webchat.bitArray.add(this.status,c):vga.webchat.bitArray.remove(this.status,c);return this};vga.webchat.userEntity.prototype.addNickname=function(a){-1===this.nicknames.indexOf(a)&&this.nicknames.push(a);return this};vga.webchat.userEntity.prototype.removeNickname=function(a){a=this.nicknames.indexOf(a);if(-1<a){var c=this.nicknames.pop();c&&a<this.nicknames.length&&(this.nicknames[a]=c)}return this};vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.connector=vga.webchat.connector||{};vga.webchat.connector.kiwi=vga.webchat.connector.kiwi||{};
(function(){function a(b){var a=b.lastIndexOf("_"),d=1;if(0<a){var c=parseInt(b.substring(a+1));isNaN(c)||(d=(c||0)+1,b=b.substring(0,a))}return b+"_"+d}vga.webchat.connector.kiwi.accessDeniedRegEx=/^Closing link: [^\r\n]*\[Access denied\]$/;vga.webchat.connector.kiwi.pingTimeoutRegEx=/^Closing link: [^\r\n]*\[Ping timeout: \d+ seconds\]$/;vga.webchat.connector.kiwi.registrationTimeOutRegEx=/^Closing link: [^\r\n]*\[Registration timeout\]$/;vga.webchat.connector.kiwi.serverShutDownRegEx=/^Closing link: [^\r\n]*\[Server shutdown\]$/;
vga.webchat.connector.kiwi.banMaskToApply="*!{identity}@*";vga.webchat.connector.kiwi.banMaskRegEx=/(\w:)?([\w\-\[\]\\\`\^\{\|\}\*]+)!([\w\-\[\]\\\`\^\{\|\}\*]+)@.+/;vga.webchat.connector.kiwi.supportedNicknameRegEx=/[a-zA-Z_]?[a-zA-Z0-9\-\[\]{}`\^\\_]+/;vga.webchat.connector.kiwi.supportedNicknameFirstCharEx=/[a-zA-Z]/;vga.webchat.connector.kiwi.wildCardMaskRegString="[\\w\\-\\[\\]\\`\\^\\{\\|\\}\\*]*";var c={"~":"q","&":"a","@":"o","%":"h","+":"v"},h={q:vga.webchat.roles.owner,a:vga.webchat.roles.admin,
o:vga.webchat.roles.mod,h:vga.webchat.roles.guest,v:vga.webchat.roles.turbo},k={b:vga.webchat.status.banned},d={m:vga.webchat.channelmodes.turbo},e={};e[vga.webchat.channelmodes.turbo]="m";var l={connect:"onConnect",disconnect:"onDisconnect",reconnect:"onReconnect",message:"onMessage",topic:"onTopic",userlist:"onUserlist",join:"onJoin",part:"onLeave",quit:"onQuit",nick:"onNick",channelmode:"onChannelMode",role:"onRole",status:"onStatus",accessdenied:"onAccessDenied",kicked:"onKicked",kick:"onKicked",
banned:"onBanned",error:"onError"};vga.webchat.connector.kiwi.connector=function(b,a){vga.webchat.connector.kiwi.CLIENT_VERSION=new vga.util.version(1,0,3);a=a||{};this._knownIdentities=new Set;this._userListByChannel={};this._prefixMap={};this._nickname=this._identity="";this._consolidateNicknames=void 0!==a.consolidateNicknames?a.consolidateNicknames:!1;this._autoJoinChannel=void 0!==a.autoJoinChannel?a.autoJoinChannel:!0;this._autoJoinChannelComplete=!1;this._supportConcurrentChannelJoins=void 0!==
a.supportConcurrentChannelJoins?a.supportConcurrentChannelJoins:!0;this._attemptReconnect=void 0!==a.attemptReconnect?a.attemptReconnect:!1;this._maxNumberOfReconnectAttempts=a.maxNumberOfReconnectAttempts||3;this._numberOfReconnectsAttempted=0;this._listener=new vga.util.listener(l,a.listeners);this._protocol=new vga.webchat.connector.kiwi.protocolwrapper(b,{listeners:[this]});console.log("[vga.webchat.connector.kiwi.connector]: Using the kiwi-connector version: "+vga.webchat.connector.kiwi.CLIENT_VERSION.toString())};
vga.webchat.connector.kiwi.connector.prototype.getMyIdentity=function(){return this._identity};vga.webchat.connector.kiwi.connector.prototype.getMyNickname=function(){return this.normalizeNickname(this._nickname)};vga.webchat.connector.kiwi.connector.prototype.getMyUserKey=function(){return this.generateUserKey(this._nickname)};vga.webchat.connector.kiwi.connector.prototype.isMe=function(b){return this._nickname.toLocaleLowerCase()===b.toLocaleLowerCase()||this._identity.toLocaleLowerCase()===b.toLocaleLowerCase()};
vga.webchat.connector.kiwi.connector.prototype.normalizeNickname=function(b){if(this._consolidateNicknames){for(var a=[],d=b.length-1;0<=d;d--)"_"===b[d]&&a.push(d);if(0<a.length)if(1===a.length&&0===(void 0!==a[0]?a[0]:-1))b=b.substring(1);else{d=0;for(var c="";0<a.length;){var e=a.pop();0<e&&(c+=b.substring(d,e));d=e+1}b=c||b}}return b};vga.webchat.connector.kiwi.connector.prototype.generateUserKey=function(b){return this.normalizeNickname(b).toLocaleLowerCase()};vga.webchat.connector.kiwi.connector.prototype.generateChannelKey=
function(b){return b.toLocaleLowerCase()};vga.webchat.connector.kiwi.connector.prototype.connect=function(b){b=b||{};if(this._protocol){this._protocol.open(b);var a=this._protocol.getState();if(a===vga.webchat.connector.kiwi.STATES.CLOSED||a===vga.webchat.connector.kiwi.STATES.OPENING)this._autoJoinChannel=(b.channel||"").toLowerCase(),this._userListByChannel={},this._prefixMap={},this._nickname=this._identity=b.nick}return this};vga.webchat.connector.kiwi.connector.prototype.send=function(b,a){b&&
a&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.send]: Sending to ("+b+"): "+a+"."),this._protocol&&this._protocol.sendIRCData("privmsg",{target:b,msg:a}));return this};vga.webchat.connector.kiwi.connector.prototype.emote=function(b,a){b&&a&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.emote]: Sending to ("+b+"): "+a+"."),this._protocol&&this._protocol.sendIRCData("ctcp",{is_request:!0,type:"ACTION",target:b,params:a}));return this};vga.webchat.connector.kiwi.connector.prototype.join=
function(b){if(b)return vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.join]: Attempting to join channel: "+b+"."),this._protocol&&this._protocol.sendIRCData("join",{channel:b,key:""}),this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.join]: Invalid channel.",b);return this};vga.webchat.connector.kiwi.connector.prototype.leave=function(b,a){if(b)return vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.leave]: Attempting to leave channel: "+b+"."),this._protocol&&
this._protocol.sendIRCData("part",{channel:b,message:a}),this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.leave]: Invalid channel.",b);return this};vga.webchat.connector.kiwi.connector.prototype.setMode=function(b,a,d){if(b)return a=e[a],vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.setMode]: (Attempting to "+(d==vga.webchat.roleModeAction.add?"add":"remove")+" the mode "+a+" on channel: "+b+")."),this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+b+" "+
(d==vga.webchat.roleModeAction.add?"+":"-")+a}),this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.setMode]: (Invalid channel "+b+").");return this};vga.webchat.connector.kiwi.connector.prototype.setUserStatus=function(b,a,d,c,e){if(b){var g="";vga.webchat.bitArray.contains(d,vga.webchat.status.banned)&&(a=vga.webchat.connector.kiwi.banMaskToApply.replace("{identity}",""+a+(this._consolidateNicknames?"":"*")),vga.webchat.bitArray.contains(d,vga.webchat.status.timed)?(g="tb",d=(e||
{duration:0}).duration||900,this._protocol&&this._protocol.sendIRCData("raw",{data:"TBAN "+b+" "+d+" m:"+a})):(g="b",this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+b+" "+(c==vga.webchat.roleModeAction.add?"+":"-")+g+" "+a})));vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.setUserStatus]: (Attempting to "+(c==vga.webchat.roleModeAction.add?"add":"remove")+" the status "+g+" on channel: "+b+").");return this}vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.setMode]: (Invalid channel "+
b+").");return this};vga.webchat.connector.kiwi.connector.prototype.setNickname=function(b){b&&(this._nickname=b,vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.nick]: (Attempting to change nickname to: "+b+")."),this._protocol&&this._protocol.sendIRCData("nick",{nick:b}));return this};vga.webchat.connector.kiwi.connector.prototype.kick=function(b,a){b&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.nick]: (Attempting to kick: "+a+")."),this._protocol&&this._protocol.sendIRCData("kick",
{channel:b,nick:a,reason:"Bye!"}));vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.setMode]: (Invalid channel "+b+").");return this};vga.webchat.connector.kiwi.connector.prototype.disconnect=function(b){this._nickname=this._identity="";this._protocol&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.disconnect]: (Attempting to disconnect with message: "+(b||"undefined")+")."),this._protocol.sendIRCData("quit",{message:b}),this._protocol.close(b));return this};vga.webchat.connector.kiwi.connector.prototype.dispose=
function(){this.disconnect();this._protocol=vga.util.safeDispose(this._protocol);return this};vga.webchat.connector.kiwi.connector.prototype.onConnect=function(b){var a="";this._numberOfReconnectsAttempted=0;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onConnect]: (AutoJoinChannel: "+(""!==this._autoJoinChannel?this._autoJoinChannel:"none")+", Nick: "+b.nick+").");""!==this._autoJoinChannel&&(this.join(this._autoJoinChannel),a=this._autoJoinChannel);this._listener.invokeListeners("connect",
{channelKey:a})};vga.webchat.connector.kiwi.connector.prototype.onDisconnect=function(b){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onDisconnected]: (Reason: '"+b.reason+"', closedByServer: "+b.closedByServer+", existingConnection: "+b.existingConnection+").");var a="Unable to reach the server.  Try again later.";if(this._attemptReconnect&&b.closedByServer&&b.existingConnection){if(this._numberOfReconnectsAttempted<this._maxNumberOfReconnectAttempts){this._numberOfReconnectsAttempted++;
vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onDisconnected]: (Attempt to reconnect is enabled, attempting try: "+this._numberOfReconnectsAttempted+").");this._listener.invokeListeners("reconnect");return}a="(Exceeded the number of retry event: "+this._maxNumberOfReconnectAttempts+"). Giving up.";vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onDisconnected]: "+a)}this._protocol&&this._protocol.close();this._listener.invokeListeners("disconnect",{closedByServer:b.closedByServer,
reason:a})};vga.webchat.connector.kiwi.connector.prototype.onOptions=function(b){var a=this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onOptions].");0===vga.util.propertyCount(this._prefixMap)&&b.options&&b.options.PREFIX&&b.options.PREFIX.forEach(function(b){b.symbol&&b.mode&&(a._prefixMap[b.symbol]=b.mode)})};vga.webchat.connector.kiwi.connector.prototype.onNick=function(b){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onNick].",b);var a=this.normalizeNickname(b.nick);
if(a=this.isMe(a))this._nickname=b.newnick;var d=this.normalizeNickname(b.newnick);this._listener.invokeListeners("nick",{userKey:this.generateUserKey(b.nick),newUserKey:this.generateUserKey(b.newnick),identity:d,nickname:b.nick,newNickName:b.newnick,isMe:a})};vga.webchat.connector.kiwi.connector.prototype.onMessage=function(b){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onMessage]: (Target: "+b.target+", Type: "+b.type+", Nickname: "+b.nick+", Message: "+b.msg+").");var a=0<b.target.length&&
"#"===b.target[0];"message"!==b.type&&"action"!==b.type||this._listener.invokeListeners("message",{userKey:this.generateUserKey(b.nick),identity:this.normalizeNickname(b.nick),nickname:b.nick,isChannel:a,target:a?this.generateChannelKey(b.target):this.generateUserKey(b.target),message:b.msg,type:b.type})};vga.webchat.connector.kiwi.connector.prototype.onTopic=function(a){var b=this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onTopic]: (Topic: "+a.topic+
", Channel: "+b+").");this._listener.invokeListeners("topic",{topic:a.topic,channelKey:b})};vga.webchat.connector.kiwi.connector.prototype.onChannel=function(a){var b=this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onChannel]: (Channel: "+b+", Identity: "+a.ident+", Type: "+a.type+").");var d="kick"!==a.type?a.nick:a.kicked,c=this.normalizeNickname(d),e=this.isMe(d);this._autoJoinChannelComplete="join"===a.type&&b===this._autoJoinChannel&&e;"join"===
a.type?(e&&this._protocol&&this._protocol.sendIRCData("raw",{data:"MODE "+this._autoJoinChannel}),this._knownIdentities.add(c)):"part"===a.type&&this._knownIdentities.delete(c);this._listener.invokeListeners(""+a.type,{channelKey:b,userKey:this.generateUserKey(d),identity:c,nickname:d,isMe:this.isMe(c)})};vga.webchat.connector.kiwi.connector.prototype.onChannelInfo=function(a){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onChannelInfo]: (Channel: "+a.channel+").");if(a.modes){var b=
vga.webchat.channelmodes.none;a.modes.forEach(function(a){a&&"+"===a.mode.substring(0,1)&&(b=vga.webchat.bitArray.add(b,d[a.mode.substring(1,2)]))});this._listener.invokeListeners("channelmode",{channelKey:this.generateChannelKey(a.channel),action:vga.webchat.roleModeAction.add,modes:b})}};vga.webchat.connector.kiwi.connector.prototype.onQuit=function(a){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onQuit]: (Nick: "+a.nick+", Identity: "+a.ident+", Message: "+a.message+").");var b=
this.normalizeNickname(a.nick);this._listener.invokeListeners("quit",{userKey:this.generateUserKey(a.nick),identity:b,nickname:a.nick,isMe:this.isMe(b)});this._knownIdentities.delete(b)};vga.webchat.connector.kiwi.connector.prototype.onMode=function(a){var b=this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onMode].");0!==a.modes.length&&a.modes.forEach(function(c){var e=(c.mode||"").trim();if(0!==e.length){var g=vga.webchat.roleModeAction.add;1<e.length&&(g="-"===e.substring(0,1)?
vga.webchat.roleModeAction.remove:vga.webchat.roleModeAction.add,e=e.substring(1,2));var h=b.generateChannelKey(a.target);if(null!==c.param)b.onUserMode(h,c.param,g,e);else b._listener.invokeListeners("channelmode",{channelKey:h,action:g,modes:vga.webchat.bitArray.compileBitArray([e],function(a){return d[a]})})}})};vga.webchat.connector.kiwi.connector.prototype.onUserMode=function(a,d,c,e){a={channelKey:a,action:c};if(k[e]){e=k[e];if(e===vga.webchat.status.banned){c=vga.webchat.connector.kiwi.banMaskRegEx.exec(d);
(null===c||4>c.length)&&vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onMode]: Invalid banmask: "+d);d=c[2];c=c[3];if("*"===d.trim()&&"*"===c.trim())return;if("*"===d)if(-1<c.indexOf("*")){var b=new RegExp(c.replace("*",vga.webchat.connector.kiwi.wildCardMaskRegString),"i"),g=[];this._knownIdentities.forEach(function(a){b.test(a)&&g.push(a)});var l=b.test(this.getMyNickname());a.identities=g}else d=c}c="status";a.status=e}else c="role",a.roles=vga.webchat.bitArray.compileBitArray([e],
function(a){return h[a]},vga.webchat.roles.shadow);e=this.normalizeNickname(d);a.userKey=this.generateUserKey(d);a.identity=e;a.nickname=d;a.isMe=void 0!==l?l:this.isMe(e);this._listener.invokeListeners(c,a)};vga.webchat.connector.kiwi.connector.prototype.onUserlist=function(a){var b=this;vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onUserlist].");var d=0<vga.util.propertyCount(this._prefixMap)?this._prefixMap:c,e=this.generateChannelKey(a.channel),k=this._userListByChannel[e];k||
(this._userListByChannel[e]=k={});a.users.forEach(function(a){for(var c=[],e=0,g=0;g<a.nick.length&&d.hasOwnProperty(a.nick[g]);g++)c.push(d[a.nick[g]]),e++;c=a.nick.substring(e);e=b.normalizeNickname(c);g=b.generateUserKey(c);b._knownIdentities.add(e);var l=k[g];l?l.addNickname(c):(a=vga.webchat.bitArray.compileBitArray(a.modes,function(a){return h[a]},vga.webchat.roles.shadow),k[g]=new vga.webchat.userEntity(e,[c],a))})};vga.webchat.connector.kiwi.connector.prototype.onUserlistEnd=function(a){a=
this.generateChannelKey(a.channel);vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onUserListEnd]: Channel: "+a);this._userListByChannel&&a&&this._userListByChannel.hasOwnProperty(a)&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onUserListEnd]: (UserList: "+this._userListByChannel[a].users+")."),this._listener.invokeListeners("userlist",{users:this._userListByChannel[a],channelKey:a}))};vga.webchat.connector.kiwi.connector.prototype.onError=function(b){vga.util.debuglog.info("[vga.webchat.connector.kiwi.connector.onError]: (Error: "+
b.error+", Reason: "+b.reason+").");switch(b.error){case "nickname_in_use":if(this._supportConcurrentChannelJoins){this.setNickname(a(this._nickname));return}break;case "erroneus_nickname":this.setNickname("_"+this._nickname);return;case "cannot_send_to_channel":this._listener.invokeListeners("kick",{userKey:this.generateUserKey(this._nickname),identity:this.normalizeNickname(this._nickname),nickname:this._nickname,isMe:!0});return;case "banned_from_channel":this._listener.invokeListeners("banned",
{userKey:this.getMyUserKey(),channelKey:this.generateChannelKey(b.channel)});return;case "chanop_privs_needed":return;case "password_mismatch":this._listener.invokeListeners("accessdenied");return;case "error":if(vga.webchat.connector.kiwi.accessDeniedRegEx.test(b.reason)){this._listener.invokeListeners("accessdenied");this._protocol&&this._protocol.close();return}}this._listener.invokeListeners("error",{reason:b.reason})}})();vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.connector=vga.webchat.connector||{};vga.webchat.connector.kiwi=vga.webchat.connector.kiwi||{};
(function(){function a(a){a=a||{};return{nick:a.nick,hostname:a.hostname,port:a.port,ssl:a.ssl,password:a.password}}function c(a,c){return{method:a,params:c}}function h(a,e){return c(vga.webchat.connector.kiwi.PROXY_PREFIX+"."+a,e||[])}vga.webchat.connector.kiwi.PACKET_STATUS={OPEN:0,CLOSE:1,PING:2,PONG:3,MESSAGE:4,UPGRADE:5,NOOP:6};vga.webchat.connector.kiwi.STATES={CLOSED:0,CLOSING:1,OPENING:2,SOCKET_OPENED:3,PROXY_OPENED:4,PROXY_CONNECTED:5,OPENED:6};var k={connect:"onConnect",channel:"onChannel",
options:"onOptions",irc_error:"onError",disconnect:"onDisconnect",message:"onMessage",userlist:"onUserlist",userlist_end:"onUserlistEnd",channel_info:"onChannelInfo",nick:"onNick",mode:"onMode",topic:"onTopic",quit:"onQuit"};vga.webchat.connector.kiwi.DEFAULT_PING_INTERVAL=15E3;vga.webchat.connector.kiwi.DEFAULT_HEARTBEAT_INTERVAL=6E4;vga.webchat.connector.kiwi.PROXY_PREFIX="kiwi";vga.webchat.connector.kiwi.IRC_PREFIX="irc";vga.webchat.connector.kiwi.protocolwrapper=function(a,c){c=c||{};this._url=
a||"";this._state=vga.webchat.connector.kiwi.STATES.CLOSED;this._connectionInfo={};this._pingId=this._heartbeatId=null;this._listener=new vga.util.listener(k,c.listeners);this._socket=new vga.util.websocket(this._url,{listeners:[this]})};vga.webchat.connector.kiwi.protocolwrapper.prototype.getState=function(){return this._state};vga.webchat.connector.kiwi.protocolwrapper.prototype.sendRawData=function(a,c,h){c=void 0!==c?c:vga.webchat.connector.kiwi.PACKET_STATUS.MESSAGE;this._socket&&(a=a?c+("object"===
typeof a?JSON.stringify(a):a):c,this._socket.send(a,h));return this};vga.webchat.connector.kiwi.protocolwrapper.prototype.sendIRCData=function(a,e){return this.sendRawData(c(vga.webchat.connector.kiwi.IRC_PREFIX+"."+a,[(this._connectionInfo||{connectionId:0}).connectionId,e,null]))};vga.webchat.connector.kiwi.protocolwrapper.prototype.open=function(a){a=a||{};this._state=vga.webchat.connector.kiwi.STATES.OPENING;this._socket&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.open]: Attempting to open."),
this._socket.open(a));return this};vga.webchat.connector.kiwi.protocolwrapper.prototype.cleanUp=function(){clearTimeout(this._heartbeatId);clearTimeout(this._pingId);this._pingId=this._heartbeatId=null;return this};vga.webchat.connector.kiwi.protocolwrapper.prototype.close=function(a){this.cleanUp();this._state!==vga.webchat.connector.kiwi.STATES.CLOSED&&this._state!==vga.webchat.connector.kiwi.STATES.CLOSING&&(this._state=vga.webchat.connector.kiwi.STATES.CLOSING,this._socket&&this._socket.close());
return this};vga.webchat.connector.kiwi.protocolwrapper.prototype.dispose=function(){this.close();this._socket=null;return this};vga.webchat.connector.kiwi.protocolwrapper.prototype.onProxyOpened=function(a){a=a||{};vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onProxyOpened]: Proxy Connection Opened (Sid: "+a.sid+", PingInterval: "+a.pingInterval+", PingTimeout: "+a.pingTimeout+").");this._state=vga.webchat.connector.kiwi.STATES.PROXY_OPENED;this._connectionInfo={sid:a.sid,
pingInterval:a.pingInterval,pingTimeout:a.pingTimeout,connectionId:0}};vga.webchat.connector.kiwi.protocolwrapper.prototype.onProxyConnected=function(a){var c=this;this._state=vga.webchat.connector.kiwi.STATES.PROXY_CONNECTED;vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onProxyConnected]: Proxy Connected.");if(!this._heartbeatId){var d=this._connectionInfo.pingTimeout||vga.webchat.connector.kiwi.DEFAULT_HEARTBEAT_INTERVAL,b=function(){c._heartbeatId=setTimeout(function(){c.sendRawData(h("heartbeat"));
b()},d)};b()}if(!this._pingId){var g=this._connectionInfo.pingInterval||vga.webchat.connector.kiwi.DEFAULT_PING_INTERVAL,k=function(){c._pingId=setTimeout(function(){c.sendRawData("",vga.webchat.connector.kiwi.PACKET_STATUS.PING);k()},g)};k()}};vga.webchat.connector.kiwi.protocolwrapper.prototype.onConnect=function(a){this._state===vga.webchat.connector.kiwi.STATES.PROXY_CONNECTED&&(vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onConnect]: Received a PROXY_CONNECTED state, setting OPENED state."),
this._state=vga.webchat.connector.kiwi.STATES.OPENED,this._connectionInfo.connectionId=a.connection_id)};vga.webchat.connector.kiwi.protocolwrapper.prototype.onOpen=function(c,e){var d=this;this._state=vga.webchat.connector.kiwi.STATES.SOCKET_OPENED;vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onOpen]",c);this.sendRawData("",vga.webchat.connector.kiwi.PACKET_STATUS.UPGRADE);var b=function(){setTimeout(function(){d._state===vga.webchat.connector.kiwi.STATES.PROXY_CONNECTED?(d.sendRawData(h("client_info",
[{build_version:vga.webchat.connector.kiwi.CLIENT_VERSION.toString()}])),d.sendRawData(h("connect_irc",a(e)),void 0,!1)):d._state===vga.webchat.connector.kiwi.STATES.CLOSED?vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onOpen]: Received a CLOSED state before completing the transition to the PROXY_CONNECTED state."):b()},500)};b()};vga.webchat.connector.kiwi.protocolwrapper.prototype.onClose=function(a){vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onClose]: (State before close: "+
this._state+").");a=this._state===vga.webchat.connector.kiwi.STATES.CLOSING?{reason:"User closed the connection.",closedByServer:!1,existingConnection:!0}:{reason:"Server closed the connection.",closedByServer:!0,existingConnection:this._state===vga.webchat.connector.kiwi.STATES.OPENED};this._state=vga.webchat.connector.kiwi.STATES.CLOSED;this.cleanUp();this._listener.invokeListeners("disconnect",a)};vga.webchat.connector.kiwi.protocolwrapper.prototype.onMessage=function(a){a=a.data;var c=parseInt(a.substring(0,
1));a=JSON.parse(a.substring(1)||"{}");if(void 0===a)vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: Empty message.");else switch(c){case vga.webchat.connector.kiwi.PACKET_STATUS.OPEN:this.onProxyOpened(a);break;case vga.webchat.connector.kiwi.PACKET_STATUS.MESSAGE:c=a.params[0].data||{};var d=a.params[0].command.toLowerCase()||"";vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: (EventData: "+c+", Command: "+d+").",c);if(a.method===vga.webchat.connector.kiwi.PROXY_PREFIX)this.onProxyConnected(c);
else if(a.method===vga.webchat.connector.kiwi.IRC_PREFIX){if("connect"===d)this.onConnect(c);else if("disconnect"==d){this.onClose({reason:c.reason});break}this._listener.invokeListeners(d,c)}else vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: (Unknown method: "+a.method+").");break;case vga.webchat.connector.kiwi.PACKET_STATUS.PONG:vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: Server Pong.");break;case vga.webchat.connector.kiwi.PACKET_STATUS.PING:vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: Server Ping responding with Pong.");
this.sendRawData(vga.webchat.connector.kiwi.PACKET_STATUS.PONG);break;default:vga.util.debuglog.info("[vga.webchat.connector.kiwi.protocolwrapper.onMessage]: (Unhandled status: "+c+").")}}})();vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.ui=vga.webchat.ui||{};$(function(){}());vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.ui=vga.webchat.ui||{};
(function(){vga.webchat.ui.scrollmanager=function(a){a=a||{};if(!a.$channelContainer)throw new vga.util.exception("ui.scrollmanager","The $channelContainer must be set.");this._$channelContainer=a.$channelContainer;this._smoothScroll=void 0!==a.smoothScroll?a.smoothScroll:!0;this._smoothScrollState=vga.webchat.smoothScrollState.stopped};vga.webchat.ui.scrollmanager.prototype.enableSmooth=function(a){this._smoothScroll=a};vga.webchat.ui.scrollmanager.prototype.start=function(){var a=this,c=function(){a._smoothScrollState!==
vga.webchat.smoothScrollState.stopped&&(a._smoothScrollIntervalId=setTimeout(function(){if(a._smoothScrollState===vga.webchat.smoothScrollState.started){var h=a._$channelContainer.find(":not(#channel-tab-template)").find(".channel-window");$.each(h,function(c,d){c=$(d).prop("scrollHeight");var e=$(d).prop("scrollTop"),h=Math.ceil(e+$(d).height());if(h<c){if(a._smoothScroll){var b=1;h<c-140&&(b=Math.round(1+(c-h)/50));c=e+b}$(d).scrollTop(c)}})}c()},33))};this._smoothScrollState=vga.webchat.smoothScrollState.started;
c()};vga.webchat.ui.scrollmanager.prototype.stop=function(){this._smoothScrollState=vga.webchat.smoothScrollState.stopped;clearTimeout(this._smoothScrollIntervalId)};vga.webchat.ui.scrollmanager.prototype.pause=function(a){this._smoothScrollState!==vga.webchat.smoothScrollState.stopped&&(this._smoothScrollState=a?vga.webchat.smoothScrollState.paused:vga.webchat.smoothScrollState.started)}})();vga=vga||{};vga.webchat=vga.webchat||{};vga.webchat.ui=vga.webchat.ui||{};
(function(){vga.webchat.ui.thememanager=function(a){a=a||{};this._themes=a.themes||[]};vga.webchat.ui.thememanager.prototype.start=function(){var a=this;if(0!==this._themes.length){var c=function(){a._themesIntervalId=setTimeout(function(){var h=new Date;a._themes.forEach(function(a){var c=new Date(a.beginDate),e=new Date(a.endDate);c.setFullYear(h.getFullYear());e.setFullYear(h.getFullYear());$("body").toggleClass(a.name,h>=c&&h<=e)});c()},1E3)};c()}};vga.webchat.ui.thememanager.prototype.stop=function(){clearTimeout(this._themesIntervalId)}})();vga=vga||{};vga.webchat=vga.webchat||{};
$(function(){function a(a){switch(vga.webchat.getMostSignificantRole(a)){case vga.webchat.roles.owner:case vga.webchat.roles.admin:return"crew";case vga.webchat.roles.mod:return"mod";case vga.webchat.roles.guest:return"guest";case vga.webchat.roles.turbo:return"turbo";default:return"shadow"}}function c(a){return vga.webchat.getMostSignificantRole(a)>=vga.webchat.roles.mod}function h(a){$("#login-wrapper").toggleClass("hidden",!a);a&&y.focus()}function k(a){$(".spinner").toggleClass("hidden",!a);$("#vgairc_loginform").toggleClass("hidden",
a)}function d(a,b){var f=$("#slide_message");f.text(a||"").toggleClass("hidden",!a);k(!1);b&&setTimeout(function(){f.fadeOut("slow",function(){f.toggleClass("hidden",!0).css("display","")})},b)}function e(a){if(!a)return $("");var f=r.find("#channel-tab-"+a.replace("#",""));if(0===f.length){var b=r.find("#channel-tab-template");f=b.clone();f.attr("id","channel-tab-"+a.replace("#","")).removeClass("hidden").data("channel",a).data("channel",a);b.addClass("hidden");r.append(f)}return f}function l(a){$.each(r.find(".channel-tab").not(a),
function(a,f){a=$(f);a.addClass("hidden");g(a,!1)});a.removeClass("hidden");g(a,!0)}function b(a){return e(a).find(".channel-window")}function g(a,b){a.find(".user-list-button").toggleClass("disabled",!b);a=a.find(".chatbox");a.prop("disabled",!b);b&&a.focus()}function n(a,c){var f=b(a);Array.isArray(c)?c.forEach(function(a){f.append('<div class="informative"><span class="message">'+vga.util.encodeHTML(a)+"</span></div>")}):f.append('<div class="informative text-center"><span class="message">'+vga.util.encodeHTML(c)+
"</span></div>")}function u(f,c){f=b(f).find(".user-entry[data-identity="+c.identity+"]");vga.webchat.getMostSignificantStatus(c.status)===vga.webchat.status.banned?f.remove():(c=a(c.roles),f.find(".role").removeClass().addClass("role "+c).find(".icon").attr("title",c))}function v(f){var b="";f.nicknames.forEach(function(a){b+=""+(0<b.length?",":"")+a});var c=vga.webchat.getMostSignificantStatus(f.status)===vga.webchat.status.banned?"banned":"";c=c?c:a(f.roles);return"<div data-identity='"+f.identity+
"' class='user-entry'><div class='role "+c+"'>"+('<div class="icon" title="'+c+'"></div>')+("<div class='username' title=\"Nicknames: "+b+'">'+f.identity+"</div>")+"</div></div>"}function w(a){a.html(a.find("div[data-identity]").sort(function(a,f){a=($(a).data("identity").toString()||"").toLowerCase();f=($(f).data("identity").toString()||"").toLowerCase();return a<f?-1:a>f?1:0}))}function t(a,b){var f=e(a).find(".user-list-wrapper .user-list");a=f.find(".mod-section-body");var q=f.find(".guest-section-body"),
d=f.find(".regular-section-body");f=f.find(".user-entry[data-identity="+b.identity+"]");if(0===b.nicknames.length)f.remove();else{var g=d;c(b.roles)?g=a:vga.webchat.getMostSignificantRole(b.roles)===vga.webchat.roles.guest&&(g=q);0!==f.length&&f.remove();g.append(v(b));w(g)}a.parent().toggleClass("hidden",0==a.find("div").length);q.parent().toggleClass("hidden",0==q.find("div").length);d.parent().toggleClass("hidden",0==d.find("div").length)}function z(a,b){a=e(a).find(".user-list-wrapper .user-list");
var f=a.find(".mod-section-body"),d=a.find(".guest-section-body"),q=a.find(".regular-section-body");f.html("");d.html("");q.html("");b&&vga.util.forEach(b,function(a,b){a=q;c(b.roles)?a=f:vga.webchat.getMostSignificantRole(b.roles)===vga.webchat.roles.guest&&(a=d);a.append(v(b));w(a)});f.parent().toggleClass("hidden",0===f.find("div").length);d.parent().toggleClass("hidden",0===d.find("div").length);q.parent().toggleClass("hidden",0===q.find("div").length)}var r=$(".channel-container"),x=$("#settings-container"),
A=$("#channel"),y=$("#nickname"),B=$("#password");vga.webchat.chat=function(a){a=a||{};if(!a.url)throw new vga.util.exception("webchat.chat","The url cannot be empty.");if(!a.hostname)throw new vga.util.exception("webchat.chat","The hostname must be set.");if(!a.port)throw new vga.util.exception("webchat.chat","The port must be set.");vga.webchat.chat.CLIENT_VERSION=new vga.util.version(1,1,4);this._userChannels={};this._hostname=a.hostname;this._port=a.port;this._ssl=void 0===a.ssl?!1:a.ssl;this._debug=
void 0==a.debug?!1:a.debug;this._wallRegEx=a.wallRegEx||/^%! ([^\r\n]*)/;this._defaultChannel=a.defaultChannel;this._showUserJoinLeaveMessage=void 0!==a.showUserJoinLeaveMessage?a.showUserJoinLeaveMessage:!1;this._timedBanDurationInSeconds=void 0!==a.timedBanDurationInSeconds?a.timedBanDurationInSeconds:300;this._nicknameColorSeedFunction=a.nicknameColorSeedFunction;this._hyperlinkRegEx=a.hyperlinkRegEx||/https?:\/\/[\w.\/?&#%=\-,+@!:\[\]\(\)\$';]+/ig;var b=void 0!==a.consolidateNicknames?a.consolidateNicknames:
!1,f=void 0!==a.enableReconnect?a.enableReconnect:!0,c=!this._defaultChannel;void 0!==a.enableFrashShowMode&&a.enableFrashShowMode&&this.setFrashShowMode(!0);this._debug&&vga.util.enableDebug();this.themeManager=new vga.webchat.ui.thememanager({themes:a.themes});this.scrollManager=new vga.webchat.ui.scrollmanager({$channelContainer:r,smoothScroll:a.smoothScroll});this.bindEvents();this.onLoadSettings();console.log("[vga.webchat.chat]: Starting chat version: "+vga.webchat.chat.CLIENT_VERSION.toString());
this.connector=new vga.webchat.connector.kiwi.connector(a.url,{supportConcurrentChannelJoins:a.supportConcurrentChannelJoins,autoJoinChannel:c,attemptReconnect:f,consolidateNicknames:b,listeners:[this]})};vga.webchat.chat.prototype.writeMessage=function(f,d,e,g){g=g||"message";var q=""+("action"===g?"allowColor":""),h="",p=this._userChannels[f];p&&(p=p[this.connector.getMyUserKey()])&&c(p.roles)&&(h='<span class="timeout"><i class="fa fa-ban" role="button" title="Timeout Chatter!"></i></span>');this._wallRegEx.test(e)&&
c(d.roles)&&(p=this._wallRegEx.exec(e),1<p.length&&(e=p[1],q="modbroadcast"));if(!this._frashShowMode&&this._hyperlinkRegEx&&this._hyperlinkRegEx.test(e)){this._hyperlinkRegEx.lastIndex=0;p=this._hyperlinkRegEx;var k="",m=0,l;for(p.lastIndex=0;(l=p.exec(e))&&!(k+=vga.util.encodeHTML(e.substring(m,l.index)),m=e.substr(l.index,l[0].length),k+="<a href='"+m+"' target='_blank'>"+vga.util.encodeHTML(m)+"</a>",m=p.lastIndex||0,0>p.flags.indexOf("g")););0<m&&(k+=vga.util.encodeHTML(e.substring(m)));e=k.trim()}else e=
vga.util.encodeHTML(e).trim();p=void 0!==d?d.identity.trim():"undefined";k=a(void 0!==d?d.roles:vga.webchat.roles.shadow);d=d.identity;m=this._nicknameColorSeedFunction&&this._nicknameColorSeedFunction()||0;for(l=0;l<d.length;l++)m+=d.charCodeAt(l);d=""+(m%7+1);m=p;"privateTO"===g?m="To ["+m+"]":"privateFROM"===g&&(m="From ["+m+"]");m=(m[0]||"").toLocaleUpperCase()+m.substring(1);b(f).append("<div class='user-entry nickColor"+d+"' data-identity='"+p+"'><div class='role "+k+"'>"+('<div class="icon" title="'+
k+'"></div>'+h)+("<span class='username allowColor'>"+m.trim()+("action"!==g?":&nbsp":"&nbsp")+"</span>")+("<span class='message "+q+"'>"+e+"</span>")+"</div></div>")};vga.webchat.chat.prototype.showToggleSetting=function(a,b){x.find(".settings-item[data-settings-type='"+a+"']").toggleClass("hidden",!b)};vga.webchat.chat.prototype.toggleSettingItem=function(a,b){x.find(".settings-item[data-settings-type='"+a+"'] > i").toggleClass("fa-toggle-off",!b).toggleClass("fa-toggle-on",b)};vga.webchat.chat.prototype.setFrashShowMode=
function(a){this._frashShowMode=a;this.showToggleSetting("join-mode",!a);this.showToggleSetting("frash-show-mode",!0);this.toggleSettingItem("frash-show-mode",a);$("html").toggleClass("frash-show-mode",a)};vga.webchat.chat.prototype.connect=function(a,b,c){this.connector.connect({nick:a.trim(),hostname:this._hostname,port:this._port,ssl:this._ssl,password:b.trim(),channel:(c||this._defaultChannel||"").trim()});return this};vga.webchat.chat.prototype.close=function(a){this.connector&&this.connector.disconnect(a);
return this};vga.webchat.chat.prototype.send=function(a,b){return a?"/"===b[0]?(b=b.splitFirstOccurrence(" "),this.handleUserCommand(a,b.first.trim().toLowerCase(),b.second)):this.handleUserMessage(a,b):this};vga.webchat.chat.prototype.join=function(a){this._userChannels[a]?l(e(a)):this.connector&&this.connector.join(a);return this};vga.webchat.chat.prototype.leave=function(a,b){this._userChannels[a]&&(this.connector&&this.connector.leave(a,b),l(e(a)));return this};vga.webchat.chat.prototype.emote=
function(a,b){this.connector.emote(a,b);var f=this._userChannels[a];f&&(f=f[this.connector.getMyUserKey()],this.writeMessage(a,f,b,"action"))};vga.webchat.chat.prototype.whisper=function(a,b,c){this.connector&&this.connector.send(b,c);var f=this._userChannels[a];f&&((f=f[b.toLowerCase()])?this.writeMessage(a,f,""+c,"privateTO"):n(a,"The user '"+b+"' was not found."))};vga.webchat.chat.prototype.help=function(a){n(a,"The following commands are available:;USAGE NOTE: Command [Alias] argument (optional argument);EXAMPLE USAGE(1): /emote dances.;EXAMPLE USAGE(2): /tell cafftest Hello.;/help [/h /?] -- Help information, this screen.;/quit [/q] (message) -- Quits the chat with an optional message.;/join #channelName -- Joins a specific channel.;/leave (message) -- Leaves the current channel tab with an optional message.;/emote [/me /e /em] emote -- Performs an emote on the current channel.;/whisper [/tell /r] nickname message -- Sends a private message to the nickname.".split(";"))};
vga.webchat.chat.prototype.handleUserMessage=function(a,b){this.connector&&this.connector.send(a,b);var f=this._userChannels[a];f&&(f=f[this.connector.getMyUserKey()],this.writeMessage(a,f,b));return this};vga.webchat.chat.prototype.handleUserCommand=function(a,b,c){switch(b){case "/quit":case "/q":this.close(c||"Bye VGA Webchat");break;case "/join":this.join(c);break;case "/leave":this.leave(a,c);break;case "/me":case "/e":case "/em":case "/emote":this.emote(a,c);break;case "/r":case "/whisper":case "/tell":b=
c.splitFirstOccurrence(" ");this.whisper(a,b.first,b.second);break;case "/help":case "/h":case "/?":this.help(a)}return this};vga.webchat.chat.prototype.setTurboMode=function(a,b){this.connector&&(this.connector.setMode("#"+a,vga.webchat.channelmodes.turbo,b?vga.webchat.roleModeAction.add:vga.webchat.roleModeAction.remove),this.toggleSettingItem("turbo-mode",b));return this};vga.webchat.chat.prototype.setTimedBan=function(a,b,c){if(this.connector){var f=vga.webchat.bitArray.add(0,vga.webchat.status.banned|
vga.webchat.status.timed);this.connector.setUserStatus(a,b,f,c?vga.webchat.roleModeAction.add:vga.webchat.roleModeAction.remove,{duration:this._timedBanDurationInSeconds})}return this};vga.webchat.chat.prototype.onConnect=function(a){d();h(!1);this.scrollManager.start();this.themeManager.start();n(a.channelKey,"VGA Chat version:"+vga.webchat.chat.CLIENT_VERSION.toString())};vga.webchat.chat.prototype.onDisconnect=function(a){this.scrollManager.stop();this.themeManager.stop();h(!0);a.closedByServer&&
d(a.reason,5E3);vga.util.forEach(this._userChannels,function(f,c){c=e(f);g(c,!1);b(f).toggleClass("pulse",!1);n(f,a.closedByServer?"Disconnected by the server.":"You have quit.")})};vga.webchat.chat.prototype.onReconnect=function(){d("The server stopped responding...retrying.",5E3);this.onLogin()};vga.webchat.chat.prototype.onTopic=function(a){n(a.channelKey,a.topic)};vga.webchat.chat.prototype.onChannelMode=function(a){var b=this._userChannels[a.channelKey];if(b){var c=e(a.channelKey);a.modes===
vga.webchat.channelmodes.turbo&&(this.toggleSettingItem("turbo-mode",a.action===vga.webchat.roleModeAction.add),a.action===vga.webchat.roleModeAction.add?(n(a.channelKey,"The room is now in TURBO only mode."),a=b[this.connector.getMyUserKey()],c.find("input.chatbox").prop("disabled",vga.webchat.getMostSignificantRole(a.roles)===vga.webchat.roles.shadow)):(n(a.channelKey,"The room is now free for all chatters."),c.find("input.chatbox").prop("disabled",!1)))}};vga.webchat.chat.prototype.onNick=function(a){vga.util.forEach(this._userChannels,
function(b,c){var f=c[a.userKey];f&&(f.identity=a.identity,f.removeNickname(a.nickname).addNickname(a.newNickName));a.userKey!==a.newUserKey&&(c[a.newUserKey]=f,c[a.userKey]=void 0);t(b,f);u(b,f)})};vga.webchat.chat.prototype.onMessage=function(a){var b=this;if(!this._wallRegEx.test(a.message)||!this._frashShowMode){var c=function(c,f,d){f&&b.writeMessage(c,f[a.userKey],a.message,d)};a.isChannel?c(a.target,this._userChannels[a.target],a.type):vga.util.forEach(this._userChannels,function(a,b){c(a,
b,"privateFROM")})}};vga.webchat.chat.prototype.onUserlist=function(a){this._userChannels[a.channelKey]=a.users;z(a.channelKey,a.users)};vga.webchat.chat.prototype.onJoin=function(a){if(a.isMe){var c=e(a.channelKey);l(c);b(a.channelKey).toggleClass("pulse",!1);n(a.channelKey,"Joined "+a.channelKey+" channel.")}else if(c=this._userChannels[a.channelKey]){var f=c[a.userKey];f||(f=new vga.webchat.userEntity(a.identity,a.nickname),c[a.userKey]=f,this._frashShowMode||!this._showUserJoinLeaveMessage||a.isMe||
this.writeMessage(a.channelKey,f,"has joined.","action"));f.addNickname(a.nickname);t(a.channelKey,f)}};vga.webchat.chat.prototype.onLeave=function(a){if(a.isMe)n(a.channelKey,"Left "+a.channelKey+" channel."),delete this._userChannels[a.channelKey],(a=Object.getOwnPropertyNames(this._userChannels).pop())?(a=e(a),l(a)):this.close("Bye VGA Webchat");else{var b=this._userChannels[a.channelKey];if(b){var c=b[a.userKey];c&&(c.removeNickname(a.nickname),0===c.nicknames.length&&(b[a.userKey]=void 0,this._frashShowMode||
!this._showUserJoinLeaveMessage||a.isMe||this.writeMessage(a.channelKey,c,"has left.","action")),t(a.channelKey,c))}}};vga.webchat.chat.prototype.onQuit=function(a){var b=this;vga.util.forEach(this._userChannels,function(c,f){b.onLeave({channelKey:c,userKey:a.userKey,nickname:a.nickname,isMe:a.IsMe})})};vga.webchat.chat.prototype.onRole=function(a){var b=this._userChannels[a.channelKey];if(b){var f=b[a.userKey];f&&(f.applyRoles(a.action,a.roles),t(a.channelKey,f),u(a.channelKey,f),a.isMe&&(a=b[this.connector.getMyUserKey()],
this.showToggleSetting("turbo-mode",a&&c(a.roles))))}};vga.webchat.chat.prototype.onStatus=function(a){var b=this._userChannels[a.channelKey];if(b){var c=function(c){if(c=b[c])c.applyStatus(a.action,a.status),t(a.channelKey,c),u(a.channelKey,c)};if("*"===a.userKey&&a.identities)for(var f=$jscomp.makeIterator(a.identities),d=f.next();!d.done;d=f.next())c(d.value);else c(a.userKey);a.isMe&&a.status===vga.webchat.status.banned&&n(a.channelKey,a.action===vga.webchat.roleModeAction.add?"You have been timed out.":
"Your timeout has expired.")}};vga.webchat.chat.prototype.onAccessDenied=function(){d("Invalid login, please try again")};vga.webchat.chat.prototype.onKicked=function(a){a.isMe&&(vga.util.debuglog.info("[vga.webchat.chat.onKicked]: You've been kicked"),this.close(),d("You have been kicked."))};vga.webchat.chat.prototype.onBanned=function(a){this.close();d("You have been banned.")};vga.webchat.chat.prototype.onError=function(a){d("Sorry, an unknown error has occured.");vga.util.debuglog.error(a.reason)};
vga.webchat.chat.prototype.bindEvents=function(){var a=this;$("#vgairc_loginform").off().on("submit",function(b){a.onLogin();b.preventDefault();setTimeout(function(){history.replaceState({success:!0},"title")},100)}).on("keyup","input",function(b){if(13===b.which)a.onLogin()});r.off().on("keyup","input",function(b){a.onSendCommandMessage($(b.currentTarget),b.which)}).on("click",".user-list-button",function(b){a.onUserListToggle($(b.currentTarget));b.preventDefault()}).on("click",".user-settings-button",
function(b){a.onGlobalSettingsMenu($(b.currentTarget));b.preventDefault()}).on("click",".settings-item",function(b){a.onSettingsItemToggle($(b.currentTarget));b.preventDefault()}).on("mouseenter mouseleave",".channel-window",function(b){a.onChannelWindowHover("mouseenter"===b.type)}).on("click",".timeout",function(b){a.onTimeoutUser($(b.currentTarget));b.preventDefault()})};vga.webchat.chat.prototype.onLogin=function(){var a=(A.val()||this._defaultChannel||"").trim();k(!0);b(a).toggleClass("pulse",
!0);this.connect(y.val(),B.val(),a)};vga.webchat.chat.prototype.onUserListToggle=function(a){a.hasClass("disabled")||(a=a.parents(".channel-tab").find(".user-list-wrapper"),a.toggleClass("hidden",!a.hasClass("hidden")))};vga.webchat.chat.prototype.onGlobalSettingsMenu=function(a){a=$("#settings-container");a.toggleClass("hidden",!a.hasClass("hidden"))};vga.webchat.chat.prototype.onLoadSettings=function(){var a="true"===vga.util.readCookie("join-mode","false"),b="true"===vga.util.readCookie("smooth-scroll-mode",
"true");this._showUserJoinLeaveMessage=a;this.scrollManager.enableSmooth(b);this.toggleSettingItem("join-mode",a);this.toggleSettingItem("smooth-scroll-mode",b)};vga.webchat.chat.prototype.onSettingsItemToggle=function(a){var b=a.find("i"),c=!b.hasClass("fa-toggle-on");switch(a.data("settings-type")){case "frash-show-mode":this.setFrashShowMode(c);break;case "turbo-mode":a=a.data("channels");this.setTurboMode(a,c);break;case "join-mode":this._showUserJoinLeaveMessage=c;b.toggleClass("fa-toggle-off",
!c).toggleClass("fa-toggle-on",c);vga.util.setCookie("join-mode",c);break;case "smooth-scroll-mode":this.scrollManager.enableSmooth(c),b.toggleClass("fa-toggle-off",!c).toggleClass("fa-toggle-on",c),vga.util.setCookie("smooth-scroll-mode",c)}};vga.webchat.chat.prototype.onTimeoutUser=function(a){var b=a.parents(".user-entry");a=b.parents(".channel-tab");b=b.data("identity");a=a.data("channel");b&&a&&this.setTimedBan(a,b,!0)};vga.webchat.chat.prototype.onChannelWindowHover=function(a){this.scrollManager.pause(a)};
vga.webchat.chat.prototype.onSendCommandMessage=function(a,b){var c=a.val();13===b&&""!==c&&(a.val(""),a=a.parents(".channel-tab").data("channel"),this.send(a,c))}}());
